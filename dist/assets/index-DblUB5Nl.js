(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=e(i);fetch(i.href,l)}})();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let tn,nn;function on(){return{geminiUrl:tn,vertexUrl:nn}}function rn(o,t,e){var n,i,l;if(!(!((n=o.httpOptions)===null||n===void 0)&&n.baseUrl)){const a=on();return o.vertexai?(i=a.vertexUrl)!==null&&i!==void 0?i:t:(l=a.geminiUrl)!==null&&l!==void 0?l:e}return o.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Z{}function I(o,t){const e=/\{([^}]+)\}/g;return o.replace(e,(n,i)=>{if(Object.prototype.hasOwnProperty.call(t,i)){const l=t[i];return l!=null?String(l):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function s(o,t,e){for(let l=0;l<t.length-1;l++){const a=t[l];if(a.endsWith("[]")){const d=a.slice(0,-2);if(!(d in o))if(Array.isArray(e))o[d]=Array.from({length:e.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(o[d])){const c=o[d];if(Array.isArray(e))for(let u=0;u<c.length;u++){const f=c[u];s(f,t.slice(l+1),e[u])}else for(const u of c)s(u,t.slice(l+1),e)}return}else if(a.endsWith("[0]")){const d=a.slice(0,-3);d in o||(o[d]=[{}]);const c=o[d];s(c[0],t.slice(l+1),e);return}(!o[a]||typeof o[a]!="object")&&(o[a]={}),o=o[a]}const n=t[t.length-1],i=o[n];if(i!==void 0){if(!e||typeof e=="object"&&Object.keys(e).length===0||e===i)return;if(typeof i=="object"&&typeof e=="object"&&i!==null&&e!==null)Object.assign(i,e);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else o[n]=e}function r(o,t){try{if(t.length===1&&t[0]==="_self")return o;for(let e=0;e<t.length;e++){if(typeof o!="object"||o===null)return;const n=t[e];if(n.endsWith("[]")){const i=n.slice(0,-2);if(i in o){const l=o[i];return Array.isArray(l)?l.map(a=>r(a,t.slice(e+1))):void 0}else return}else o=o[n]}return o}catch(e){if(e instanceof TypeError)return;throw e}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function P(o,t){if(!t||typeof t!="string")throw new Error("model is required and must be a string");if(o.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(t.indexOf("/")>=0){const e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}else return`publishers/google/models/${t}`}else return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function bt(o,t){const e=P(o,t);return e?e.startsWith("publishers/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}`:e.startsWith("models/")&&o.isVertexAI()?`projects/${o.getProject()}/locations/${o.getLocation()}/publishers/google/${e}`:e:""}function Vt(o,t){return Array.isArray(t)?t.map(e=>ie(o,e)):[ie(o,t)]}function ie(o,t){if(typeof t=="object"&&t!==null)return t;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof t}`)}function sn(o,t){const e=ie(o,t);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function ln(o,t){const e=ie(o,t);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Re(o,t){if(t==null)throw new Error("PartUnion is required");if(typeof t=="object")return t;if(typeof t=="string")return{text:t};throw new Error(`Unsupported part type: ${typeof t}`)}function Ut(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("PartListUnion is required");return Array.isArray(t)?t.map(e=>Re(o,e)):[Re(o,t)]}function fe(o){return o!=null&&typeof o=="object"&&"parts"in o&&Array.isArray(o.parts)}function De(o){return o!=null&&typeof o=="object"&&"functionCall"in o}function ke(o){return o!=null&&typeof o=="object"&&"functionResponse"in o}function k(o,t){if(t==null)throw new Error("ContentUnion is required");return fe(t)?t:{role:"user",parts:Ut(o,t)}}function Ft(o,t){if(!t)return[];if(o.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{const n=k(o,e);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(o.isVertexAI()){const e=k(o,t);return e.parts&&e.parts.length>0&&e.parts[0].text!==void 0?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>k(o,e)):[k(o,t)]}function G(o,t){if(t==null||Array.isArray(t)&&t.length===0)throw new Error("contents are required");if(!Array.isArray(t)){if(De(t)||ke(t))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[k(o,t)]}const e=[],n=[],i=fe(t[0]);for(const l of t){const a=fe(l);if(a!=i)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(a)e.push(l);else{if(De(l)||ke(l))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");n.push(l)}}return i||e.push({role:"user",parts:Ut(o,n)}),e}function Gt(o,t){return t}function qt(o,t){if(typeof t=="object")return t;if(typeof t=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:t}}};throw new Error(`Unsupported speechConfig type: ${typeof t}`)}function le(o,t){return t}function ae(o,t){if(!Array.isArray(t))throw new Error("tool is required and must be an array of Tools");return t}function an(o,t,e,n=1){const i=!t.startsWith(`${e}/`)&&t.split("/").length===n;return o.isVertexAI()?t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${o.getProject()}/${t}`:t.startsWith(`${e}/`)?`projects/${o.getProject()}/locations/${o.getLocation()}/${t}`:i?`projects/${o.getProject()}/locations/${o.getLocation()}/${e}/${t}`:t:i?`${e}/${t}`:t}function q(o,t){if(typeof t!="string")throw new Error("name must be a string");return an(o,t,"cachedContents")}function Bt(o,t){switch(t){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return t}}function B(o,t){if(typeof t!="string")throw new Error("fromImageBytes must be a string");return t}function un(o){return o!=null&&typeof o=="object"&&"name"in o}function dn(o){return o!=null&&typeof o=="object"&&"video"in o}function cn(o){return o!=null&&typeof o=="object"&&"uri"in o}function $t(o,t){var e;let n;if(un(t)&&(n=t.name),!(cn(t)&&(n=t.uri,n===void 0))&&!(dn(t)&&(n=(e=t.video)===null||e===void 0?void 0:e.uri,n===void 0))){if(typeof t=="string"&&(n=t),n===void 0)throw new Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){const l=n.split("files/")[1].match(/[a-z0-9]+/);if(l===null)throw new Error(`Could not extract file name from URI ${n}`);n=l[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function Ht(o,t){let e;return o.isVertexAI()?e=t?"publishers/google/models":"models":e=t?"models":"tunedModels",e}function zt(o,t){for(const e of["models","tunedModels","publisherModels"])if(fn(t,e))return t[e];return[]}function fn(o,t){return o!==null&&typeof o=="object"&&t in o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function pn(o,t){const e={};if(r(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(t,["data"]);n!=null&&s(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function gn(o,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],pn(o,i));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function Ne(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>gn(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function mn(){return{}}function hn(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function yn(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],hn(o,n)),e}function vn(o,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&s(e,["googleSearch"],mn());const i=r(t,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],yn(o,i)),r(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const l=r(t,["codeExecution"]);l!=null&&s(e,["codeExecution"],l);const a=r(t,["functionDeclarations"]);return a!=null&&s(e,["functionDeclarations"],a),e}function Tn(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Cn(o,t){const e={},n=r(t,["functionCallingConfig"]);if(n!=null&&s(e,["functionCallingConfig"],Tn(o,n)),r(t,["retrievalConfig"])!==void 0)throw new Error("retrievalConfig parameter is not supported in Gemini API.");return e}function En(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(t,["expireTime"]);e!==void 0&&l!=null&&s(e,["expireTime"],l);const a=r(t,["displayName"]);e!==void 0&&a!=null&&s(e,["displayName"],a);const d=r(t,["contents"]);if(e!==void 0&&d!=null){let p=G(o,d);Array.isArray(p)&&(p=p.map(g=>Ne(o,g))),s(e,["contents"],p)}const c=r(t,["systemInstruction"]);e!==void 0&&c!=null&&s(e,["systemInstruction"],Ne(o,k(o,c)));const u=r(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(g=>vn(o,g))),s(e,["tools"],p)}const f=r(t,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],Cn(o,f)),n}function In(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["model"],bt(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],En(o,i,e)),e}function _n(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],q(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Sn(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],q(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function An(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(t,["expireTime"]);return e!==void 0&&l!=null&&s(e,["expireTime"],l),n}function wn(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],q(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],An(o,i,e)),e}function Mn(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);return e!==void 0&&l!=null&&s(e,["_query","pageToken"],l),n}function xn(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],Mn(o,n,e)),e}function Pn(o,t){const e={},n=r(t,["displayName"]);n!=null&&s(e,["displayName"],n);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function Rn(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["inlineData"]);l!=null&&s(e,["inlineData"],Pn(o,l));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const d=r(t,["executableCode"]);d!=null&&s(e,["executableCode"],d);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function Le(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Rn(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Dn(){return{}}function kn(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Nn(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],kn(o,n)),e}function Ln(){return{}}function bn(o,t){const e={},n=r(t,["apiKeyString"]);return n!=null&&s(e,["apiKeyString"],n),e}function Vn(o,t){const e={},n=r(t,["apiKeyConfig"]);n!=null&&s(e,["apiKeyConfig"],bn(o,n));const i=r(t,["authType"]);i!=null&&s(e,["authType"],i);const l=r(t,["googleServiceAccountConfig"]);l!=null&&s(e,["googleServiceAccountConfig"],l);const a=r(t,["httpBasicAuthConfig"]);a!=null&&s(e,["httpBasicAuthConfig"],a);const d=r(t,["oauthConfig"]);d!=null&&s(e,["oauthConfig"],d);const c=r(t,["oidcConfig"]);return c!=null&&s(e,["oidcConfig"],c),e}function Un(o,t){const e={},n=r(t,["authConfig"]);return n!=null&&s(e,["authConfig"],Vn(o,n)),e}function Fn(o,t){const e={},n=r(t,["retrieval"]);n!=null&&s(e,["retrieval"],n),r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Dn());const l=r(t,["googleSearchRetrieval"]);l!=null&&s(e,["googleSearchRetrieval"],Nn(o,l)),r(t,["enterpriseWebSearch"])!=null&&s(e,["enterpriseWebSearch"],Ln());const d=r(t,["googleMaps"]);d!=null&&s(e,["googleMaps"],Un(o,d));const c=r(t,["codeExecution"]);c!=null&&s(e,["codeExecution"],c);const u=r(t,["functionDeclarations"]);return u!=null&&s(e,["functionDeclarations"],u),e}function Gn(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function qn(o,t){const e={},n=r(t,["latitude"]);n!=null&&s(e,["latitude"],n);const i=r(t,["longitude"]);return i!=null&&s(e,["longitude"],i),e}function Bn(o,t){const e={},n=r(t,["latLng"]);return n!=null&&s(e,["latLng"],qn(o,n)),e}function $n(o,t){const e={},n=r(t,["functionCallingConfig"]);n!=null&&s(e,["functionCallingConfig"],Gn(o,n));const i=r(t,["retrievalConfig"]);return i!=null&&s(e,["retrievalConfig"],Bn(o,i)),e}function Hn(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(t,["expireTime"]);e!==void 0&&l!=null&&s(e,["expireTime"],l);const a=r(t,["displayName"]);e!==void 0&&a!=null&&s(e,["displayName"],a);const d=r(t,["contents"]);if(e!==void 0&&d!=null){let p=G(o,d);Array.isArray(p)&&(p=p.map(g=>Le(o,g))),s(e,["contents"],p)}const c=r(t,["systemInstruction"]);e!==void 0&&c!=null&&s(e,["systemInstruction"],Le(o,k(o,c)));const u=r(t,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(g=>Fn(o,g))),s(e,["tools"],p)}const f=r(t,["toolConfig"]);return e!==void 0&&f!=null&&s(e,["toolConfig"],$n(o,f)),n}function zn(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["model"],bt(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],Hn(o,i,e)),e}function Jn(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],q(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Kn(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],q(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Wn(o,t,e){const n={},i=r(t,["ttl"]);e!==void 0&&i!=null&&s(e,["ttl"],i);const l=r(t,["expireTime"]);return e!==void 0&&l!=null&&s(e,["expireTime"],l),n}function Yn(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],q(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],Wn(o,i,e)),e}function On(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);return e!==void 0&&l!=null&&s(e,["_query","pageToken"],l),n}function Xn(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],On(o,n,e)),e}function ne(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["model"]);l!=null&&s(e,["model"],l);const a=r(t,["createTime"]);a!=null&&s(e,["createTime"],a);const d=r(t,["updateTime"]);d!=null&&s(e,["updateTime"],d);const c=r(t,["expireTime"]);c!=null&&s(e,["expireTime"],c);const u=r(t,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function Zn(){return{}}function Qn(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>ne(o,a))),s(e,["cachedContents"],l)}return e}function oe(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["model"]);l!=null&&s(e,["model"],l);const a=r(t,["createTime"]);a!=null&&s(e,["createTime"],a);const d=r(t,["updateTime"]);d!=null&&s(e,["updateTime"],d);const c=r(t,["expireTime"]);c!=null&&s(e,["expireTime"],c);const u=r(t,["usageMetadata"]);return u!=null&&s(e,["usageMetadata"],u),e}function jn(){return{}}function eo(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["cachedContents"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>oe(o,a))),s(e,["cachedContents"],l)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var W;(function(o){o.PAGED_ITEM_BATCH_JOBS="batchJobs",o.PAGED_ITEM_MODELS="models",o.PAGED_ITEM_TUNING_JOBS="tuningJobs",o.PAGED_ITEM_FILES="files",o.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(W||(W={}));class ue{constructor(t,e,n,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=e,this.init(t,n,i)}init(t,e,n){var i,l;this.nameInternal=t,this.pageInternal=e[this.nameInternal]||[],this.idxInternal=0;let a={config:{}};n?typeof n=="object"?a=Object.assign({},n):a=n:a={config:{}},a.config&&(a.config.pageToken=e.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(l=(i=a.config)===null||i===void 0?void 0:i.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return((t=this.params.config)===null||t===void 0?void 0:t.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var be;(function(o){o.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",o.OUTCOME_OK="OUTCOME_OK",o.OUTCOME_FAILED="OUTCOME_FAILED",o.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(be||(be={}));var Ve;(function(o){o.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",o.PYTHON="PYTHON"})(Ve||(Ve={}));var Ue;(function(o){o.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",o.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",o.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",o.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",o.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",o.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Ue||(Ue={}));var Fe;(function(o){o.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",o.SEVERITY="SEVERITY",o.PROBABILITY="PROBABILITY"})(Fe||(Fe={}));var Ge;(function(o){o.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF"})(Ge||(Ge={}));var qe;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(qe||(qe={}));var Be;(function(o){o.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",o.NO_AUTH="NO_AUTH",o.API_KEY_AUTH="API_KEY_AUTH",o.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",o.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",o.OAUTH="OAUTH",o.OIDC_AUTH="OIDC_AUTH"})(Be||(Be={}));var $e;(function(o){o.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",o.STRING="STRING",o.NUMBER="NUMBER",o.INTEGER="INTEGER",o.BOOLEAN="BOOLEAN",o.ARRAY="ARRAY",o.OBJECT="OBJECT"})($e||($e={}));var He;(function(o){o.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",o.STOP="STOP",o.MAX_TOKENS="MAX_TOKENS",o.SAFETY="SAFETY",o.RECITATION="RECITATION",o.LANGUAGE="LANGUAGE",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT",o.SPII="SPII",o.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",o.IMAGE_SAFETY="IMAGE_SAFETY"})(He||(He={}));var ze;(function(o){o.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH"})(ze||(ze={}));var Je;(function(o){o.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",o.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",o.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",o.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",o.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Je||(Je={}));var Ke;(function(o){o.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",o.SAFETY="SAFETY",o.OTHER="OTHER",o.BLOCKLIST="BLOCKLIST",o.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(Ke||(Ke={}));var We;(function(o){o.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",o.ON_DEMAND="ON_DEMAND",o.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(We||(We={}));var b;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.AUDIO="AUDIO"})(b||(b={}));var Ye;(function(o){o.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",o.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",o.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",o.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(Ye||(Ye={}));var pe;(function(o){o.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",o.JOB_STATE_QUEUED="JOB_STATE_QUEUED",o.JOB_STATE_PENDING="JOB_STATE_PENDING",o.JOB_STATE_RUNNING="JOB_STATE_RUNNING",o.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",o.JOB_STATE_FAILED="JOB_STATE_FAILED",o.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",o.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",o.JOB_STATE_PAUSED="JOB_STATE_PAUSED",o.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",o.JOB_STATE_UPDATING="JOB_STATE_UPDATING",o.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(pe||(pe={}));var Oe;(function(o){o.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",o.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",o.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",o.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",o.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",o.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",o.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Oe||(Oe={}));var Xe;(function(o){o.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",o.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",o.BALANCED="BALANCED",o.PRIORITIZE_COST="PRIORITIZE_COST"})(Xe||(Xe={}));var Ze;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.MODE_DYNAMIC="MODE_DYNAMIC"})(Ze||(Ze={}));var Qe;(function(o){o.MODE_UNSPECIFIED="MODE_UNSPECIFIED",o.AUTO="AUTO",o.ANY="ANY",o.NONE="NONE"})(Qe||(Qe={}));var je;(function(o){o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE"})(je||(je={}));var et;(function(o){o.DONT_ALLOW="DONT_ALLOW",o.ALLOW_ADULT="ALLOW_ADULT",o.ALLOW_ALL="ALLOW_ALL"})(et||(et={}));var tt;(function(o){o.auto="auto",o.en="en",o.ja="ja",o.ko="ko",o.hi="hi"})(tt||(tt={}));var nt;(function(o){o.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",o.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",o.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",o.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",o.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(nt||(nt={}));var ot;(function(o){o.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",o.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",o.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",o.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(ot||(ot={}));var it;(function(o){o.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",o.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",o.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",o.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(it||(it={}));var rt;(function(o){o.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",o.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",o.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",o.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",o.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",o.EDIT_MODE_STYLE="EDIT_MODE_STYLE",o.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",o.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(rt||(rt={}));var st;(function(o){o.STATE_UNSPECIFIED="STATE_UNSPECIFIED",o.PROCESSING="PROCESSING",o.ACTIVE="ACTIVE",o.FAILED="FAILED"})(st||(st={}));var lt;(function(o){o.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",o.UPLOADED="UPLOADED",o.GENERATED="GENERATED"})(lt||(lt={}));var at;(function(o){o.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",o.TEXT="TEXT",o.IMAGE="IMAGE",o.VIDEO="VIDEO",o.AUDIO="AUDIO",o.DOCUMENT="DOCUMENT"})(at||(at={}));var ut;(function(o){o.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",o.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",o.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(ut||(ut={}));var dt;(function(o){o.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",o.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",o.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(dt||(dt={}));var ct;(function(o){o.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",o.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",o.NO_INTERRUPTION="NO_INTERRUPTION"})(ct||(ct={}));var ft;(function(o){o.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",o.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",o.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(ft||(ft={}));class Q{get text(){var t,e,n,i,l,a,d,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",f=!1;const p=[];for(const g of(c=(d=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||d===void 0?void 0:d.parts)!==null&&c!==void 0?c:[]){for(const[h,y]of Object.entries(g))h!=="text"&&h!=="thought"&&(y!==null||y!==void 0)&&p.push(h);if(typeof g.text=="string"){if(typeof g.thought=="boolean"&&g.thought)continue;f=!0,u+=g.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?u:void 0}get data(){var t,e,n,i,l,a,d,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const f=[];for(const p of(c=(d=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||d===void 0?void 0:d.parts)!==null&&c!==void 0?c:[]){for(const[g,h]of Object.entries(p))g!=="inlineData"&&(h!==null||h!==void 0)&&f.push(g);p.inlineData&&typeof p.inlineData.data=="string"&&(u+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var t,e,n,i,l,a,d,c;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(c=(d=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||d===void 0?void 0:d.parts)===null||c===void 0?void 0:c.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var t,e,n,i,l,a,d,c,u;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(c=(d=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||d===void 0?void 0:d.parts)===null||c===void 0?void 0:c.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var t,e,n,i,l,a,d,c,u;if(((i=(n=(e=(t=this.candidates)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.content)===null||n===void 0?void 0:n.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(c=(d=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||d===void 0?void 0:d.parts)===null||c===void 0?void 0:c.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.output}}class pt{}class gt{}class to{}class no{}class mt{}class ht{}class yt{}class oo{}class vt{}class Tt{}class Ct{}class io{}class ge{constructor(t){const e={};for(const n of t.headers.entries())e[n[0]]=n[1];this.headers=e,this.responseInternal=t}json(){return this.responseInternal.json()}}class ro{}class so{}class lo{get text(){var t,e,n;let i="",l=!1;const a=[];for(const d of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(const[c,u]of Object.entries(d))c!=="text"&&c!=="thought"&&u!==null&&a.push(c);if(typeof d.text=="string"){if(typeof d.thought=="boolean"&&d.thought)continue;l=!0,i+=d.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),l?i:void 0}get data(){var t,e,n;let i="";const l=[];for(const a of(n=(e=(t=this.serverContent)===null||t===void 0?void 0:t.modelTurn)===null||e===void 0?void 0:e.parts)!==null&&n!==void 0?n:[]){for(const[d,c]of Object.entries(a))d!=="inlineData"&&c!==null&&l.push(d);a.inlineData&&typeof a.inlineData.data=="string"&&(i+=atob(a.inlineData.data))}return l.length>0&&console.warn(`there are non-data parts ${l} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ao extends Z{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new ue(W.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(e),e)}async create(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=zn(this.apiClient,t);return d=I("cachedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>oe(this.apiClient,f))}else{const u=In(this.apiClient,t);return d=I("cachedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>ne(this.apiClient,f))}}async get(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Jn(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>oe(this.apiClient,f))}else{const u=_n(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>ne(this.apiClient,f))}}async delete(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Kn(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(()=>{const f=jn(),p=new Tt;return Object.assign(p,f),p})}else{const u=Sn(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(()=>{const f=Zn(),p=new Tt;return Object.assign(p,f),p})}}async update(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Yn(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>oe(this.apiClient,f))}else{const u=wn(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>ne(this.apiClient,f))}}async listInternal(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Xn(this.apiClient,t);return d=I("cachedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=eo(this.apiClient,f),g=new Ct;return Object.assign(g,p),g})}else{const u=xn(this.apiClient,t);return d=I("cachedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Qn(this.apiClient,f),g=new Ct;return Object.assign(g,p),g})}}}function Et(o){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&o[t],n=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function R(o){return this instanceof R?(this.v=o,this):new R(o)}function re(o,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(o,t||[]),i,l=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),d("next"),d("throw"),d("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(h){return function(y){return Promise.resolve(y).then(h,p)}}function d(h,y){n[h]&&(i[h]=function(v){return new Promise(function(C,S){l.push([h,v,C,S])>1||c(h,v)})},y&&(i[h]=y(i[h])))}function c(h,y){try{u(n[h](y))}catch(v){g(l[0][3],v)}}function u(h){h.value instanceof R?Promise.resolve(h.value.v).then(f,p):g(l[0][2],h)}function f(h){c("next",h)}function p(h){c("throw",h)}function g(h,y){h(y),l.shift(),l.length&&c(l[0][0],l[0][1])}}function me(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],e;return t?t.call(o):(o=typeof Et=="function"?Et(o):o[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(l){e[l]=o[l]&&function(a){return new Promise(function(d,c){a=o[l](a),i(d,c,a.done,a.value)})}}function i(l,a,d,c){Promise.resolve(c).then(function(u){l({value:u,done:d})},a)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uo(o){var t;if(o.candidates==null||o.candidates.length===0)return!1;const e=(t=o.candidates[0])===null||t===void 0?void 0:t.content;return e===void 0?!1:Jt(e)}function Jt(o){if(o.parts===void 0||o.parts.length===0)return!1;for(const t of o.parts)if(t===void 0||Object.keys(t).length===0||t.text!==void 0&&t.text==="")return!1;return!0}function co(o){if(o.length!==0){if(o[0].role!=="user")throw new Error("History must start with a user turn.");for(const t of o)if(t.role!=="user"&&t.role!=="model")throw new Error(`Role must be user or model, but got ${t.role}.`)}}function fo(o){if(o===void 0||o.length===0)return[];const t=[],e=o.length;let n=0,i=o[0];for(;n<e;)if(o[n].role==="user")i=o[n],n++;else{const l=[];let a=!0;for(;n<e&&o[n].role==="model";)l.push(o[n]),a&&!Jt(o[n])&&(a=!1),n++;a&&(t.push(i),t.push(...l))}return t}class po{constructor(t,e){this.modelsModule=t,this.apiClient=e}create(t){return new go(this.apiClient,this.modelsModule,t.model,t.config,t.history)}}class go{constructor(t,e,n,i={},l=[]){this.apiClient=t,this.modelsModule=e,this.model=n,this.config=i,this.history=l,this.sendPromise=Promise.resolve(),co(l)}async sendMessage(t){var e;await this.sendPromise;const n=k(this.apiClient,t.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});return this.sendPromise=(async()=>{var l,a;const c=(a=(l=(await i).candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content,u=c?[c]:[];this.recordHistory(n,u)})(),await this.sendPromise,i}async sendMessageStream(t){var e;await this.sendPromise;const n=k(this.apiClient,t.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(e=t.config)!==null&&e!==void 0?e:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const l=await i;return this.processStreamResponse(l,n)}getHistory(t=!1){return t?fo(this.history):this.history}processStreamResponse(t,e){var n,i;return re(this,arguments,function*(){var a,d,c,u;const f=[];try{for(var p=!0,g=me(t),h;h=yield R(g.next()),a=h.done,!a;p=!0){u=h.value,p=!1;const y=u;if(uo(y)){const v=(i=(n=y.candidates)===null||n===void 0?void 0:n[0])===null||i===void 0?void 0:i.content;v!==void 0&&f.push(v)}yield yield R(y)}}catch(y){d={error:y}}finally{try{!p&&!a&&(c=g.return)&&(yield R(c.call(g)))}finally{if(d)throw d.error}}this.recordHistory(e,f)})}recordHistory(t,e){let n=[];e.length>0&&e.every(i=>i.role==="model")?n=e:n.push({role:"model",parts:[]}),this.history.push(t),this.history.push(...n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mo(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);return e!==void 0&&l!=null&&s(e,["_query","pageToken"],l),n}function ho(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],mo(o,n,e)),e}function yo(o,t){const e={},n=r(t,["details"]);n!=null&&s(e,["details"],n);const i=r(t,["message"]);i!=null&&s(e,["message"],i);const l=r(t,["code"]);return l!=null&&s(e,["code"],l),e}function vo(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["mimeType"]);l!=null&&s(e,["mimeType"],l);const a=r(t,["sizeBytes"]);a!=null&&s(e,["sizeBytes"],a);const d=r(t,["createTime"]);d!=null&&s(e,["createTime"],d);const c=r(t,["expirationTime"]);c!=null&&s(e,["expirationTime"],c);const u=r(t,["updateTime"]);u!=null&&s(e,["updateTime"],u);const f=r(t,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=r(t,["uri"]);p!=null&&s(e,["uri"],p);const g=r(t,["downloadUri"]);g!=null&&s(e,["downloadUri"],g);const h=r(t,["state"]);h!=null&&s(e,["state"],h);const y=r(t,["source"]);y!=null&&s(e,["source"],y);const v=r(t,["videoMetadata"]);v!=null&&s(e,["videoMetadata"],v);const C=r(t,["error"]);return C!=null&&s(e,["error"],yo(o,C)),e}function To(o,t){const e={},n=r(t,["file"]);n!=null&&s(e,["file"],vo(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Co(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","file"],$t(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Eo(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","file"],$t(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Io(o,t){const e={},n=r(t,["details"]);n!=null&&s(e,["details"],n);const i=r(t,["message"]);i!=null&&s(e,["message"],i);const l=r(t,["code"]);return l!=null&&s(e,["code"],l),e}function he(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["mimeType"]);l!=null&&s(e,["mimeType"],l);const a=r(t,["sizeBytes"]);a!=null&&s(e,["sizeBytes"],a);const d=r(t,["createTime"]);d!=null&&s(e,["createTime"],d);const c=r(t,["expirationTime"]);c!=null&&s(e,["expirationTime"],c);const u=r(t,["updateTime"]);u!=null&&s(e,["updateTime"],u);const f=r(t,["sha256Hash"]);f!=null&&s(e,["sha256Hash"],f);const p=r(t,["uri"]);p!=null&&s(e,["uri"],p);const g=r(t,["downloadUri"]);g!=null&&s(e,["downloadUri"],g);const h=r(t,["state"]);h!=null&&s(e,["state"],h);const y=r(t,["source"]);y!=null&&s(e,["source"],y);const v=r(t,["videoMetadata"]);v!=null&&s(e,["videoMetadata"],v);const C=r(t,["error"]);return C!=null&&s(e,["error"],Io(o,C)),e}function _o(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["files"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>he(o,a))),s(e,["files"],l)}return e}function So(){return{}}function Ao(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class wo extends Z{constructor(t){super(),this.apiClient=t,this.list=async(e={})=>new ue(W.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(e),e)}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then(e=>he(this.apiClient,e))}async download(t){await this.apiClient.downloadFile(t)}async listInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=ho(this.apiClient,t);return l=I("files",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>{const u=_o(this.apiClient,c),f=new io;return Object.assign(f,u),f})}}async createInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=To(this.apiClient,t);return l=I("upload/v1beta/files",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(()=>{const c=So(),u=new ro;return Object.assign(u,c),u})}}async get(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Co(this.apiClient,t);return l=I("files/{file}",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>he(this.apiClient,c))}}async delete(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=Eo(this.apiClient,t);return l=I("files/{file}",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(()=>{const c=Ao(),u=new so;return Object.assign(u,c),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Mo(o,t){const e={};if(r(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(t,["data"]);n!=null&&s(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function xo(o,t){const e={},n=r(t,["displayName"]);n!=null&&s(e,["displayName"],n);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function Po(o,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],Mo(o,i));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function Ro(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["inlineData"]);l!=null&&s(e,["inlineData"],xo(o,l));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const d=r(t,["executableCode"]);d!=null&&s(e,["executableCode"],d);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function Do(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Po(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function ko(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Ro(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function No(){return{}}function Lo(){return{}}function bo(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Vo(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function Uo(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],bo(o,n)),e}function Fo(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],Vo(o,n)),e}function Go(){return{}}function qo(o,t){const e={},n=r(t,["apiKeyString"]);return n!=null&&s(e,["apiKeyString"],n),e}function Bo(o,t){const e={},n=r(t,["apiKeyConfig"]);n!=null&&s(e,["apiKeyConfig"],qo(o,n));const i=r(t,["authType"]);i!=null&&s(e,["authType"],i);const l=r(t,["googleServiceAccountConfig"]);l!=null&&s(e,["googleServiceAccountConfig"],l);const a=r(t,["httpBasicAuthConfig"]);a!=null&&s(e,["httpBasicAuthConfig"],a);const d=r(t,["oauthConfig"]);d!=null&&s(e,["oauthConfig"],d);const c=r(t,["oidcConfig"]);return c!=null&&s(e,["oidcConfig"],c),e}function $o(o,t){const e={},n=r(t,["authConfig"]);return n!=null&&s(e,["authConfig"],Bo(o,n)),e}function Ho(o,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&s(e,["googleSearch"],No());const i=r(t,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],Uo(o,i)),r(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const l=r(t,["codeExecution"]);l!=null&&s(e,["codeExecution"],l);const a=r(t,["functionDeclarations"]);return a!=null&&s(e,["functionDeclarations"],a),e}function zo(o,t){const e={},n=r(t,["retrieval"]);n!=null&&s(e,["retrieval"],n),r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Lo());const l=r(t,["googleSearchRetrieval"]);l!=null&&s(e,["googleSearchRetrieval"],Fo(o,l)),r(t,["enterpriseWebSearch"])!=null&&s(e,["enterpriseWebSearch"],Go());const d=r(t,["googleMaps"]);d!=null&&s(e,["googleMaps"],$o(o,d));const c=r(t,["codeExecution"]);c!=null&&s(e,["codeExecution"],c);const u=r(t,["functionDeclarations"]);return u!=null&&s(e,["functionDeclarations"],u),e}function Jo(o,t){const e={},n=r(t,["handle"]);if(n!=null&&s(e,["handle"],n),r(t,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Ko(o,t){const e={},n=r(t,["handle"]);n!=null&&s(e,["handle"],n);const i=r(t,["transparent"]);return i!=null&&s(e,["transparent"],i),e}function It(){return{}}function _t(){return{}}function Wo(o,t){const e={},n=r(t,["disabled"]);n!=null&&s(e,["disabled"],n);const i=r(t,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const l=r(t,["endOfSpeechSensitivity"]);l!=null&&s(e,["endOfSpeechSensitivity"],l);const a=r(t,["prefixPaddingMs"]);a!=null&&s(e,["prefixPaddingMs"],a);const d=r(t,["silenceDurationMs"]);return d!=null&&s(e,["silenceDurationMs"],d),e}function Yo(o,t){const e={},n=r(t,["disabled"]);n!=null&&s(e,["disabled"],n);const i=r(t,["startOfSpeechSensitivity"]);i!=null&&s(e,["startOfSpeechSensitivity"],i);const l=r(t,["endOfSpeechSensitivity"]);l!=null&&s(e,["endOfSpeechSensitivity"],l);const a=r(t,["prefixPaddingMs"]);a!=null&&s(e,["prefixPaddingMs"],a);const d=r(t,["silenceDurationMs"]);return d!=null&&s(e,["silenceDurationMs"],d),e}function Oo(o,t){const e={},n=r(t,["automaticActivityDetection"]);n!=null&&s(e,["automaticActivityDetection"],Wo(o,n));const i=r(t,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const l=r(t,["turnCoverage"]);return l!=null&&s(e,["turnCoverage"],l),e}function Xo(o,t){const e={},n=r(t,["automaticActivityDetection"]);n!=null&&s(e,["automaticActivityDetection"],Yo(o,n));const i=r(t,["activityHandling"]);i!=null&&s(e,["activityHandling"],i);const l=r(t,["turnCoverage"]);return l!=null&&s(e,["turnCoverage"],l),e}function Zo(o,t){const e={},n=r(t,["targetTokens"]);return n!=null&&s(e,["targetTokens"],n),e}function Qo(o,t){const e={},n=r(t,["targetTokens"]);return n!=null&&s(e,["targetTokens"],n),e}function jo(o,t){const e={},n=r(t,["triggerTokens"]);n!=null&&s(e,["triggerTokens"],n);const i=r(t,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],Zo(o,i)),e}function ei(o,t){const e={},n=r(t,["triggerTokens"]);n!=null&&s(e,["triggerTokens"],n);const i=r(t,["slidingWindow"]);return i!=null&&s(e,["slidingWindow"],Qo(o,i)),e}function ti(o,t,e){const n={},i=r(t,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const l=r(t,["responseModalities"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","responseModalities"],l);const a=r(t,["temperature"]);e!==void 0&&a!=null&&s(e,["setup","generationConfig","temperature"],a);const d=r(t,["topP"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","topP"],d);const c=r(t,["topK"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topK"],c);const u=r(t,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const f=r(t,["mediaResolution"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","mediaResolution"],f);const p=r(t,["seed"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","seed"],p);const g=r(t,["speechConfig"]);e!==void 0&&g!=null&&s(e,["setup","generationConfig","speechConfig"],g);const h=r(t,["systemInstruction"]);e!==void 0&&h!=null&&s(e,["setup","systemInstruction"],Do(o,k(o,h)));const y=r(t,["tools"]);if(e!==void 0&&y!=null){let E=ae(o,y);Array.isArray(E)&&(E=E.map(w=>Ho(o,le(o,w)))),s(e,["setup","tools"],E)}const v=r(t,["sessionResumption"]);e!==void 0&&v!=null&&s(e,["setup","sessionResumption"],Jo(o,v));const C=r(t,["inputAudioTranscription"]);e!==void 0&&C!=null&&s(e,["setup","inputAudioTranscription"],It());const S=r(t,["outputAudioTranscription"]);e!==void 0&&S!=null&&s(e,["setup","outputAudioTranscription"],It());const _=r(t,["realtimeInputConfig"]);e!==void 0&&_!=null&&s(e,["setup","realtimeInputConfig"],Oo(o,_));const A=r(t,["contextWindowCompression"]);return e!==void 0&&A!=null&&s(e,["setup","contextWindowCompression"],jo(o,A)),n}function ni(o,t,e){const n={},i=r(t,["generationConfig"]);e!==void 0&&i!=null&&s(e,["setup","generationConfig"],i);const l=r(t,["responseModalities"]);e!==void 0&&l!=null&&s(e,["setup","generationConfig","responseModalities"],l);const a=r(t,["temperature"]);e!==void 0&&a!=null&&s(e,["setup","generationConfig","temperature"],a);const d=r(t,["topP"]);e!==void 0&&d!=null&&s(e,["setup","generationConfig","topP"],d);const c=r(t,["topK"]);e!==void 0&&c!=null&&s(e,["setup","generationConfig","topK"],c);const u=r(t,["maxOutputTokens"]);e!==void 0&&u!=null&&s(e,["setup","generationConfig","maxOutputTokens"],u);const f=r(t,["mediaResolution"]);e!==void 0&&f!=null&&s(e,["setup","generationConfig","mediaResolution"],f);const p=r(t,["seed"]);e!==void 0&&p!=null&&s(e,["setup","generationConfig","seed"],p);const g=r(t,["speechConfig"]);e!==void 0&&g!=null&&s(e,["setup","generationConfig","speechConfig"],g);const h=r(t,["systemInstruction"]);e!==void 0&&h!=null&&s(e,["setup","systemInstruction"],ko(o,k(o,h)));const y=r(t,["tools"]);if(e!==void 0&&y!=null){let E=ae(o,y);Array.isArray(E)&&(E=E.map(w=>zo(o,le(o,w)))),s(e,["setup","tools"],E)}const v=r(t,["sessionResumption"]);e!==void 0&&v!=null&&s(e,["setup","sessionResumption"],Ko(o,v));const C=r(t,["inputAudioTranscription"]);e!==void 0&&C!=null&&s(e,["setup","inputAudioTranscription"],_t());const S=r(t,["outputAudioTranscription"]);e!==void 0&&S!=null&&s(e,["setup","outputAudioTranscription"],_t());const _=r(t,["realtimeInputConfig"]);e!==void 0&&_!=null&&s(e,["setup","realtimeInputConfig"],Xo(o,_));const A=r(t,["contextWindowCompression"]);return e!==void 0&&A!=null&&s(e,["setup","contextWindowCompression"],ei(o,A)),n}function oi(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["setup","model"],P(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],ti(o,i,e)),e}function ii(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["setup","model"],P(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],ni(o,i,e)),e}function ri(){return{}}function si(){return{}}function li(){return{}}function ai(){return{}}function ui(o,t){const e={},n=r(t,["media"]);n!=null&&s(e,["mediaChunks"],Vt(o,n));const i=r(t,["audio"]);i!=null&&s(e,["audio"],ln(o,i));const l=r(t,["audioStreamEnd"]);l!=null&&s(e,["audioStreamEnd"],l);const a=r(t,["video"]);a!=null&&s(e,["video"],sn(o,a));const d=r(t,["text"]);return d!=null&&s(e,["text"],d),r(t,["activityStart"])!=null&&s(e,["activityStart"],ri()),r(t,["activityEnd"])!=null&&s(e,["activityEnd"],li()),e}function di(o,t){const e={},n=r(t,["media"]);if(n!=null&&s(e,["mediaChunks"],Vt(o,n)),r(t,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const i=r(t,["audioStreamEnd"]);if(i!=null&&s(e,["audioStreamEnd"],i),r(t,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(r(t,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return r(t,["activityStart"])!=null&&s(e,["activityStart"],si()),r(t,["activityEnd"])!=null&&s(e,["activityEnd"],ai()),e}function ci(){return{}}function fi(){return{}}function pi(o,t){const e={},n=r(t,["data"]);n!=null&&s(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function gi(o,t){const e={},n=r(t,["displayName"]);n!=null&&s(e,["displayName"],n);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function mi(o,t){const e={},n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],pi(o,i));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function hi(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["inlineData"]);l!=null&&s(e,["inlineData"],gi(o,l));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const d=r(t,["executableCode"]);d!=null&&s(e,["executableCode"],d);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function yi(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>mi(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function vi(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>hi(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function St(o,t){const e={},n=r(t,["text"]);n!=null&&s(e,["text"],n);const i=r(t,["finished"]);return i!=null&&s(e,["finished"],i),e}function At(o,t){const e={},n=r(t,["text"]);n!=null&&s(e,["text"],n);const i=r(t,["finished"]);return i!=null&&s(e,["finished"],i),e}function Ti(o,t){const e={},n=r(t,["modelTurn"]);n!=null&&s(e,["modelTurn"],yi(o,n));const i=r(t,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const l=r(t,["interrupted"]);l!=null&&s(e,["interrupted"],l);const a=r(t,["groundingMetadata"]);a!=null&&s(e,["groundingMetadata"],a);const d=r(t,["generationComplete"]);d!=null&&s(e,["generationComplete"],d);const c=r(t,["inputTranscription"]);c!=null&&s(e,["inputTranscription"],St(o,c));const u=r(t,["outputTranscription"]);return u!=null&&s(e,["outputTranscription"],St(o,u)),e}function Ci(o,t){const e={},n=r(t,["modelTurn"]);n!=null&&s(e,["modelTurn"],vi(o,n));const i=r(t,["turnComplete"]);i!=null&&s(e,["turnComplete"],i);const l=r(t,["interrupted"]);l!=null&&s(e,["interrupted"],l);const a=r(t,["groundingMetadata"]);a!=null&&s(e,["groundingMetadata"],a);const d=r(t,["generationComplete"]);d!=null&&s(e,["generationComplete"],d);const c=r(t,["inputTranscription"]);c!=null&&s(e,["inputTranscription"],At(o,c));const u=r(t,["outputTranscription"]);return u!=null&&s(e,["outputTranscription"],At(o,u)),e}function Ei(o,t){const e={},n=r(t,["id"]);n!=null&&s(e,["id"],n);const i=r(t,["args"]);i!=null&&s(e,["args"],i);const l=r(t,["name"]);return l!=null&&s(e,["name"],l),e}function Ii(o,t){const e={},n=r(t,["args"]);n!=null&&s(e,["args"],n);const i=r(t,["name"]);return i!=null&&s(e,["name"],i),e}function _i(o,t){const e={},n=r(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>Ei(o,l))),s(e,["functionCalls"],i)}return e}function Si(o,t){const e={},n=r(t,["functionCalls"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>Ii(o,l))),s(e,["functionCalls"],i)}return e}function Ai(o,t){const e={},n=r(t,["ids"]);return n!=null&&s(e,["ids"],n),e}function wi(o,t){const e={},n=r(t,["ids"]);return n!=null&&s(e,["ids"],n),e}function j(o,t){const e={},n=r(t,["modality"]);n!=null&&s(e,["modality"],n);const i=r(t,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function ee(o,t){const e={},n=r(t,["modality"]);n!=null&&s(e,["modality"],n);const i=r(t,["tokenCount"]);return i!=null&&s(e,["tokenCount"],i),e}function Mi(o,t){const e={},n=r(t,["promptTokenCount"]);n!=null&&s(e,["promptTokenCount"],n);const i=r(t,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const l=r(t,["responseTokenCount"]);l!=null&&s(e,["responseTokenCount"],l);const a=r(t,["toolUsePromptTokenCount"]);a!=null&&s(e,["toolUsePromptTokenCount"],a);const d=r(t,["thoughtsTokenCount"]);d!=null&&s(e,["thoughtsTokenCount"],d);const c=r(t,["totalTokenCount"]);c!=null&&s(e,["totalTokenCount"],c);const u=r(t,["promptTokensDetails"]);if(u!=null){let h=u;Array.isArray(h)&&(h=h.map(y=>j(o,y))),s(e,["promptTokensDetails"],h)}const f=r(t,["cacheTokensDetails"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(y=>j(o,y))),s(e,["cacheTokensDetails"],h)}const p=r(t,["responseTokensDetails"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(y=>j(o,y))),s(e,["responseTokensDetails"],h)}const g=r(t,["toolUsePromptTokensDetails"]);if(g!=null){let h=g;Array.isArray(h)&&(h=h.map(y=>j(o,y))),s(e,["toolUsePromptTokensDetails"],h)}return e}function xi(o,t){const e={},n=r(t,["promptTokenCount"]);n!=null&&s(e,["promptTokenCount"],n);const i=r(t,["cachedContentTokenCount"]);i!=null&&s(e,["cachedContentTokenCount"],i);const l=r(t,["candidatesTokenCount"]);l!=null&&s(e,["responseTokenCount"],l);const a=r(t,["toolUsePromptTokenCount"]);a!=null&&s(e,["toolUsePromptTokenCount"],a);const d=r(t,["thoughtsTokenCount"]);d!=null&&s(e,["thoughtsTokenCount"],d);const c=r(t,["totalTokenCount"]);c!=null&&s(e,["totalTokenCount"],c);const u=r(t,["promptTokensDetails"]);if(u!=null){let y=u;Array.isArray(y)&&(y=y.map(v=>ee(o,v))),s(e,["promptTokensDetails"],y)}const f=r(t,["cacheTokensDetails"]);if(f!=null){let y=f;Array.isArray(y)&&(y=y.map(v=>ee(o,v))),s(e,["cacheTokensDetails"],y)}const p=r(t,["candidatesTokensDetails"]);if(p!=null){let y=p;Array.isArray(y)&&(y=y.map(v=>ee(o,v))),s(e,["responseTokensDetails"],y)}const g=r(t,["toolUsePromptTokensDetails"]);if(g!=null){let y=g;Array.isArray(y)&&(y=y.map(v=>ee(o,v))),s(e,["toolUsePromptTokensDetails"],y)}const h=r(t,["trafficType"]);return h!=null&&s(e,["trafficType"],h),e}function Pi(o,t){const e={},n=r(t,["timeLeft"]);return n!=null&&s(e,["timeLeft"],n),e}function Ri(o,t){const e={},n=r(t,["timeLeft"]);return n!=null&&s(e,["timeLeft"],n),e}function Di(o,t){const e={},n=r(t,["newHandle"]);n!=null&&s(e,["newHandle"],n);const i=r(t,["resumable"]);i!=null&&s(e,["resumable"],i);const l=r(t,["lastConsumedClientMessageIndex"]);return l!=null&&s(e,["lastConsumedClientMessageIndex"],l),e}function ki(o,t){const e={},n=r(t,["newHandle"]);n!=null&&s(e,["newHandle"],n);const i=r(t,["resumable"]);i!=null&&s(e,["resumable"],i);const l=r(t,["lastConsumedClientMessageIndex"]);return l!=null&&s(e,["lastConsumedClientMessageIndex"],l),e}function Ni(o,t){const e={};r(t,["setupComplete"])!=null&&s(e,["setupComplete"],ci());const i=r(t,["serverContent"]);i!=null&&s(e,["serverContent"],Ti(o,i));const l=r(t,["toolCall"]);l!=null&&s(e,["toolCall"],_i(o,l));const a=r(t,["toolCallCancellation"]);a!=null&&s(e,["toolCallCancellation"],Ai(o,a));const d=r(t,["usageMetadata"]);d!=null&&s(e,["usageMetadata"],Mi(o,d));const c=r(t,["goAway"]);c!=null&&s(e,["goAway"],Pi(o,c));const u=r(t,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],Di(o,u)),e}function Li(o,t){const e={};r(t,["setupComplete"])!=null&&s(e,["setupComplete"],fi());const i=r(t,["serverContent"]);i!=null&&s(e,["serverContent"],Ci(o,i));const l=r(t,["toolCall"]);l!=null&&s(e,["toolCall"],Si(o,l));const a=r(t,["toolCallCancellation"]);a!=null&&s(e,["toolCallCancellation"],wi(o,a));const d=r(t,["usageMetadata"]);d!=null&&s(e,["usageMetadata"],xi(o,d));const c=r(t,["goAway"]);c!=null&&s(e,["goAway"],Ri(o,c));const u=r(t,["sessionResumptionUpdate"]);return u!=null&&s(e,["sessionResumptionUpdate"],ki(o,u)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function bi(o,t){const e={};if(r(t,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=r(t,["data"]);n!=null&&s(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Vi(o,t){const e={};if(r(t,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],bi(o,i));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function de(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Vi(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Ui(o,t){const e={};if(r(t,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=r(t,["category"]);n!=null&&s(e,["category"],n);const i=r(t,["threshold"]);return i!=null&&s(e,["threshold"],i),e}function Fi(){return{}}function Gi(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function qi(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],Gi(o,n)),e}function Bi(o,t){const e={};if(r(t,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");r(t,["googleSearch"])!=null&&s(e,["googleSearch"],Fi());const i=r(t,["googleSearchRetrieval"]);if(i!=null&&s(e,["googleSearchRetrieval"],qi(o,i)),r(t,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(r(t,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const l=r(t,["codeExecution"]);l!=null&&s(e,["codeExecution"],l);const a=r(t,["functionDeclarations"]);return a!=null&&s(e,["functionDeclarations"],a),e}function $i(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Hi(o,t){const e={},n=r(t,["functionCallingConfig"]);if(n!=null&&s(e,["functionCallingConfig"],$i(o,n)),r(t,["retrievalConfig"])!==void 0)throw new Error("retrievalConfig parameter is not supported in Gemini API.");return e}function zi(o,t){const e={},n=r(t,["voiceName"]);return n!=null&&s(e,["voiceName"],n),e}function Ji(o,t){const e={},n=r(t,["prebuiltVoiceConfig"]);return n!=null&&s(e,["prebuiltVoiceConfig"],zi(o,n)),e}function Ki(o,t){const e={},n=r(t,["voiceConfig"]);n!=null&&s(e,["voiceConfig"],Ji(o,n));const i=r(t,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function Wi(o,t){const e={},n=r(t,["includeThoughts"]);n!=null&&s(e,["includeThoughts"],n);const i=r(t,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function Yi(o,t,e){const n={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],de(o,k(o,i)));const l=r(t,["temperature"]);l!=null&&s(n,["temperature"],l);const a=r(t,["topP"]);a!=null&&s(n,["topP"],a);const d=r(t,["topK"]);d!=null&&s(n,["topK"],d);const c=r(t,["candidateCount"]);c!=null&&s(n,["candidateCount"],c);const u=r(t,["maxOutputTokens"]);u!=null&&s(n,["maxOutputTokens"],u);const f=r(t,["stopSequences"]);f!=null&&s(n,["stopSequences"],f);const p=r(t,["responseLogprobs"]);p!=null&&s(n,["responseLogprobs"],p);const g=r(t,["logprobs"]);g!=null&&s(n,["logprobs"],g);const h=r(t,["presencePenalty"]);h!=null&&s(n,["presencePenalty"],h);const y=r(t,["frequencyPenalty"]);y!=null&&s(n,["frequencyPenalty"],y);const v=r(t,["seed"]);v!=null&&s(n,["seed"],v);const C=r(t,["responseMimeType"]);C!=null&&s(n,["responseMimeType"],C);const S=r(t,["responseSchema"]);if(S!=null&&s(n,["responseSchema"],Gt(o,S)),r(t,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(r(t,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const _=r(t,["safetySettings"]);if(e!==void 0&&_!=null){let M=_;Array.isArray(M)&&(M=M.map(U=>Ui(o,U))),s(e,["safetySettings"],M)}const A=r(t,["tools"]);if(e!==void 0&&A!=null){let M=ae(o,A);Array.isArray(M)&&(M=M.map(U=>Bi(o,le(o,U)))),s(e,["tools"],M)}const E=r(t,["toolConfig"]);if(e!==void 0&&E!=null&&s(e,["toolConfig"],Hi(o,E)),r(t,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const w=r(t,["cachedContent"]);e!==void 0&&w!=null&&s(e,["cachedContent"],q(o,w));const N=r(t,["responseModalities"]);N!=null&&s(n,["responseModalities"],N);const V=r(t,["mediaResolution"]);V!=null&&s(n,["mediaResolution"],V);const L=r(t,["speechConfig"]);if(L!=null&&s(n,["speechConfig"],Ki(o,qt(o,L))),r(t,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const F=r(t,["thinkingConfig"]);return F!=null&&s(n,["thinkingConfig"],Wi(o,F)),n}function wt(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["contents"]);if(i!=null){let a=G(o,i);Array.isArray(a)&&(a=a.map(d=>de(o,d))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["generationConfig"],Yi(o,l,e)),e}function Oi(o,t,e){const n={},i=r(t,["taskType"]);e!==void 0&&i!=null&&s(e,["requests[]","taskType"],i);const l=r(t,["title"]);e!==void 0&&l!=null&&s(e,["requests[]","title"],l);const a=r(t,["outputDimensionality"]);if(e!==void 0&&a!=null&&s(e,["requests[]","outputDimensionality"],a),r(t,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(r(t,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function Xi(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["contents"]);i!=null&&s(e,["requests[]","content"],Ft(o,i));const l=r(t,["config"]);l!=null&&s(e,["config"],Oi(o,l,e));const a=r(t,["model"]);return a!==void 0&&s(e,["requests[]","model"],P(o,a)),e}function Zi(o,t,e){const n={};if(r(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(t,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const i=r(t,["numberOfImages"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const l=r(t,["aspectRatio"]);e!==void 0&&l!=null&&s(e,["parameters","aspectRatio"],l);const a=r(t,["guidanceScale"]);if(e!==void 0&&a!=null&&s(e,["parameters","guidanceScale"],a),r(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const d=r(t,["safetyFilterLevel"]);e!==void 0&&d!=null&&s(e,["parameters","safetySetting"],d);const c=r(t,["personGeneration"]);e!==void 0&&c!=null&&s(e,["parameters","personGeneration"],c);const u=r(t,["includeSafetyAttributes"]);e!==void 0&&u!=null&&s(e,["parameters","includeSafetyAttributes"],u);const f=r(t,["includeRaiReason"]);e!==void 0&&f!=null&&s(e,["parameters","includeRaiReason"],f);const p=r(t,["language"]);e!==void 0&&p!=null&&s(e,["parameters","language"],p);const g=r(t,["outputMimeType"]);e!==void 0&&g!=null&&s(e,["parameters","outputOptions","mimeType"],g);const h=r(t,["outputCompressionQuality"]);if(e!==void 0&&h!=null&&s(e,["parameters","outputOptions","compressionQuality"],h),r(t,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(r(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function Qi(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(t,["config"]);return l!=null&&s(e,["config"],Zi(o,l,e)),e}function ji(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],P(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function er(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);e!==void 0&&l!=null&&s(e,["_query","pageToken"],l);const a=r(t,["filter"]);e!==void 0&&a!=null&&s(e,["_query","filter"],a);const d=r(t,["queryBase"]);return e!==void 0&&d!=null&&s(e,["_url","models_url"],Ht(o,d)),n}function tr(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],er(o,n,e)),e}function nr(o,t,e){const n={},i=r(t,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const l=r(t,["description"]);e!==void 0&&l!=null&&s(e,["description"],l);const a=r(t,["defaultCheckpointId"]);return e!==void 0&&a!=null&&s(e,["defaultCheckpointId"],a),n}function or(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],P(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],nr(o,i,e)),e}function ir(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],P(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function rr(o,t){const e={};if(r(t,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(r(t,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(r(t,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function sr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["contents"]);if(i!=null){let a=G(o,i);Array.isArray(a)&&(a=a.map(d=>de(o,d))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["config"],rr(o,l)),e}function lr(o,t){const e={};if(r(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(t,["imageBytes"]);n!=null&&s(e,["bytesBase64Encoded"],B(o,n));const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function ar(o,t,e){const n={},i=r(t,["numberOfVideos"]);if(e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i),r(t,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(r(t,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const l=r(t,["durationSeconds"]);if(e!==void 0&&l!=null&&s(e,["parameters","durationSeconds"],l),r(t,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=r(t,["aspectRatio"]);if(e!==void 0&&a!=null&&s(e,["parameters","aspectRatio"],a),r(t,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const d=r(t,["personGeneration"]);if(e!==void 0&&d!=null&&s(e,["parameters","personGeneration"],d),r(t,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=r(t,["negativePrompt"]);if(e!==void 0&&c!=null&&s(e,["parameters","negativePrompt"],c),r(t,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function ur(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(t,["image"]);l!=null&&s(e,["instances[0]","image"],lr(o,l));const a=r(t,["config"]);return a!=null&&s(e,["config"],ar(o,a,e)),e}function dr(o,t){const e={},n=r(t,["displayName"]);n!=null&&s(e,["displayName"],n);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function cr(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["inlineData"]);l!=null&&s(e,["inlineData"],dr(o,l));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const d=r(t,["executableCode"]);d!=null&&s(e,["executableCode"],d);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function Y(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>cr(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function fr(o,t){const e={},n=r(t,["featureSelectionPreference"]);return n!=null&&s(e,["featureSelectionPreference"],n),e}function pr(o,t){const e={},n=r(t,["method"]);n!=null&&s(e,["method"],n);const i=r(t,["category"]);i!=null&&s(e,["category"],i);const l=r(t,["threshold"]);return l!=null&&s(e,["threshold"],l),e}function gr(){return{}}function mr(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["dynamicThreshold"]);return i!=null&&s(e,["dynamicThreshold"],i),e}function hr(o,t){const e={},n=r(t,["dynamicRetrievalConfig"]);return n!=null&&s(e,["dynamicRetrievalConfig"],mr(o,n)),e}function yr(){return{}}function vr(o,t){const e={},n=r(t,["apiKeyString"]);return n!=null&&s(e,["apiKeyString"],n),e}function Tr(o,t){const e={},n=r(t,["apiKeyConfig"]);n!=null&&s(e,["apiKeyConfig"],vr(o,n));const i=r(t,["authType"]);i!=null&&s(e,["authType"],i);const l=r(t,["googleServiceAccountConfig"]);l!=null&&s(e,["googleServiceAccountConfig"],l);const a=r(t,["httpBasicAuthConfig"]);a!=null&&s(e,["httpBasicAuthConfig"],a);const d=r(t,["oauthConfig"]);d!=null&&s(e,["oauthConfig"],d);const c=r(t,["oidcConfig"]);return c!=null&&s(e,["oidcConfig"],c),e}function Cr(o,t){const e={},n=r(t,["authConfig"]);return n!=null&&s(e,["authConfig"],Tr(o,n)),e}function Kt(o,t){const e={},n=r(t,["retrieval"]);n!=null&&s(e,["retrieval"],n),r(t,["googleSearch"])!=null&&s(e,["googleSearch"],gr());const l=r(t,["googleSearchRetrieval"]);l!=null&&s(e,["googleSearchRetrieval"],hr(o,l)),r(t,["enterpriseWebSearch"])!=null&&s(e,["enterpriseWebSearch"],yr());const d=r(t,["googleMaps"]);d!=null&&s(e,["googleMaps"],Cr(o,d));const c=r(t,["codeExecution"]);c!=null&&s(e,["codeExecution"],c);const u=r(t,["functionDeclarations"]);return u!=null&&s(e,["functionDeclarations"],u),e}function Er(o,t){const e={},n=r(t,["mode"]);n!=null&&s(e,["mode"],n);const i=r(t,["allowedFunctionNames"]);return i!=null&&s(e,["allowedFunctionNames"],i),e}function Ir(o,t){const e={},n=r(t,["latitude"]);n!=null&&s(e,["latitude"],n);const i=r(t,["longitude"]);return i!=null&&s(e,["longitude"],i),e}function _r(o,t){const e={},n=r(t,["latLng"]);return n!=null&&s(e,["latLng"],Ir(o,n)),e}function Sr(o,t){const e={},n=r(t,["functionCallingConfig"]);n!=null&&s(e,["functionCallingConfig"],Er(o,n));const i=r(t,["retrievalConfig"]);return i!=null&&s(e,["retrievalConfig"],_r(o,i)),e}function Ar(o,t){const e={},n=r(t,["voiceName"]);return n!=null&&s(e,["voiceName"],n),e}function wr(o,t){const e={},n=r(t,["prebuiltVoiceConfig"]);return n!=null&&s(e,["prebuiltVoiceConfig"],Ar(o,n)),e}function Mr(o,t){const e={},n=r(t,["voiceConfig"]);n!=null&&s(e,["voiceConfig"],wr(o,n));const i=r(t,["languageCode"]);return i!=null&&s(e,["languageCode"],i),e}function xr(o,t){const e={},n=r(t,["includeThoughts"]);n!=null&&s(e,["includeThoughts"],n);const i=r(t,["thinkingBudget"]);return i!=null&&s(e,["thinkingBudget"],i),e}function Pr(o,t,e){const n={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],Y(o,k(o,i)));const l=r(t,["temperature"]);l!=null&&s(n,["temperature"],l);const a=r(t,["topP"]);a!=null&&s(n,["topP"],a);const d=r(t,["topK"]);d!=null&&s(n,["topK"],d);const c=r(t,["candidateCount"]);c!=null&&s(n,["candidateCount"],c);const u=r(t,["maxOutputTokens"]);u!=null&&s(n,["maxOutputTokens"],u);const f=r(t,["stopSequences"]);f!=null&&s(n,["stopSequences"],f);const p=r(t,["responseLogprobs"]);p!=null&&s(n,["responseLogprobs"],p);const g=r(t,["logprobs"]);g!=null&&s(n,["logprobs"],g);const h=r(t,["presencePenalty"]);h!=null&&s(n,["presencePenalty"],h);const y=r(t,["frequencyPenalty"]);y!=null&&s(n,["frequencyPenalty"],y);const v=r(t,["seed"]);v!=null&&s(n,["seed"],v);const C=r(t,["responseMimeType"]);C!=null&&s(n,["responseMimeType"],C);const S=r(t,["responseSchema"]);S!=null&&s(n,["responseSchema"],Gt(o,S));const _=r(t,["routingConfig"]);_!=null&&s(n,["routingConfig"],_);const A=r(t,["modelSelectionConfig"]);A!=null&&s(n,["modelConfig"],fr(o,A));const E=r(t,["safetySettings"]);if(e!==void 0&&E!=null){let D=E;Array.isArray(D)&&(D=D.map(x=>pr(o,x))),s(e,["safetySettings"],D)}const w=r(t,["tools"]);if(e!==void 0&&w!=null){let D=ae(o,w);Array.isArray(D)&&(D=D.map(x=>Kt(o,le(o,x)))),s(e,["tools"],D)}const N=r(t,["toolConfig"]);e!==void 0&&N!=null&&s(e,["toolConfig"],Sr(o,N));const V=r(t,["labels"]);e!==void 0&&V!=null&&s(e,["labels"],V);const L=r(t,["cachedContent"]);e!==void 0&&L!=null&&s(e,["cachedContent"],q(o,L));const F=r(t,["responseModalities"]);F!=null&&s(n,["responseModalities"],F);const M=r(t,["mediaResolution"]);M!=null&&s(n,["mediaResolution"],M);const U=r(t,["speechConfig"]);U!=null&&s(n,["speechConfig"],Mr(o,qt(o,U)));const H=r(t,["audioTimestamp"]);H!=null&&s(n,["audioTimestamp"],H);const K=r(t,["thinkingConfig"]);return K!=null&&s(n,["thinkingConfig"],xr(o,K)),n}function Mt(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["contents"]);if(i!=null){let a=G(o,i);Array.isArray(a)&&(a=a.map(d=>Y(o,d))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["generationConfig"],Pr(o,l,e)),e}function Rr(o,t,e){const n={},i=r(t,["taskType"]);e!==void 0&&i!=null&&s(e,["instances[]","task_type"],i);const l=r(t,["title"]);e!==void 0&&l!=null&&s(e,["instances[]","title"],l);const a=r(t,["outputDimensionality"]);e!==void 0&&a!=null&&s(e,["parameters","outputDimensionality"],a);const d=r(t,["mimeType"]);e!==void 0&&d!=null&&s(e,["instances[]","mimeType"],d);const c=r(t,["autoTruncate"]);return e!==void 0&&c!=null&&s(e,["parameters","autoTruncate"],c),n}function Dr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["contents"]);i!=null&&s(e,["instances[]","content"],Ft(o,i));const l=r(t,["config"]);return l!=null&&s(e,["config"],Rr(o,l,e)),e}function kr(o,t,e){const n={},i=r(t,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const l=r(t,["negativePrompt"]);e!==void 0&&l!=null&&s(e,["parameters","negativePrompt"],l);const a=r(t,["numberOfImages"]);e!==void 0&&a!=null&&s(e,["parameters","sampleCount"],a);const d=r(t,["aspectRatio"]);e!==void 0&&d!=null&&s(e,["parameters","aspectRatio"],d);const c=r(t,["guidanceScale"]);e!==void 0&&c!=null&&s(e,["parameters","guidanceScale"],c);const u=r(t,["seed"]);e!==void 0&&u!=null&&s(e,["parameters","seed"],u);const f=r(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&s(e,["parameters","safetySetting"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const g=r(t,["includeSafetyAttributes"]);e!==void 0&&g!=null&&s(e,["parameters","includeSafetyAttributes"],g);const h=r(t,["includeRaiReason"]);e!==void 0&&h!=null&&s(e,["parameters","includeRaiReason"],h);const y=r(t,["language"]);e!==void 0&&y!=null&&s(e,["parameters","language"],y);const v=r(t,["outputMimeType"]);e!==void 0&&v!=null&&s(e,["parameters","outputOptions","mimeType"],v);const C=r(t,["outputCompressionQuality"]);e!==void 0&&C!=null&&s(e,["parameters","outputOptions","compressionQuality"],C);const S=r(t,["addWatermark"]);e!==void 0&&S!=null&&s(e,["parameters","addWatermark"],S);const _=r(t,["enhancePrompt"]);return e!==void 0&&_!=null&&s(e,["parameters","enhancePrompt"],_),n}function Nr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(t,["config"]);return l!=null&&s(e,["config"],kr(o,l,e)),e}function Ee(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&s(e,["gcsUri"],n);const i=r(t,["imageBytes"]);i!=null&&s(e,["bytesBase64Encoded"],B(o,i));const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function Lr(o,t){const e={},n=r(t,["maskMode"]);n!=null&&s(e,["maskMode"],n);const i=r(t,["segmentationClasses"]);i!=null&&s(e,["maskClasses"],i);const l=r(t,["maskDilation"]);return l!=null&&s(e,["dilation"],l),e}function br(o,t){const e={},n=r(t,["controlType"]);n!=null&&s(e,["controlType"],n);const i=r(t,["enableControlImageComputation"]);return i!=null&&s(e,["computeControl"],i),e}function Vr(o,t){const e={},n=r(t,["styleDescription"]);return n!=null&&s(e,["styleDescription"],n),e}function Ur(o,t){const e={},n=r(t,["subjectType"]);n!=null&&s(e,["subjectType"],n);const i=r(t,["subjectDescription"]);return i!=null&&s(e,["subjectDescription"],i),e}function Fr(o,t){const e={},n=r(t,["referenceImage"]);n!=null&&s(e,["referenceImage"],Ee(o,n));const i=r(t,["referenceId"]);i!=null&&s(e,["referenceId"],i);const l=r(t,["referenceType"]);l!=null&&s(e,["referenceType"],l);const a=r(t,["maskImageConfig"]);a!=null&&s(e,["maskImageConfig"],Lr(o,a));const d=r(t,["controlImageConfig"]);d!=null&&s(e,["controlImageConfig"],br(o,d));const c=r(t,["styleImageConfig"]);c!=null&&s(e,["styleImageConfig"],Vr(o,c));const u=r(t,["subjectImageConfig"]);return u!=null&&s(e,["subjectImageConfig"],Ur(o,u)),e}function Gr(o,t,e){const n={},i=r(t,["outputGcsUri"]);e!==void 0&&i!=null&&s(e,["parameters","storageUri"],i);const l=r(t,["negativePrompt"]);e!==void 0&&l!=null&&s(e,["parameters","negativePrompt"],l);const a=r(t,["numberOfImages"]);e!==void 0&&a!=null&&s(e,["parameters","sampleCount"],a);const d=r(t,["aspectRatio"]);e!==void 0&&d!=null&&s(e,["parameters","aspectRatio"],d);const c=r(t,["guidanceScale"]);e!==void 0&&c!=null&&s(e,["parameters","guidanceScale"],c);const u=r(t,["seed"]);e!==void 0&&u!=null&&s(e,["parameters","seed"],u);const f=r(t,["safetyFilterLevel"]);e!==void 0&&f!=null&&s(e,["parameters","safetySetting"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const g=r(t,["includeSafetyAttributes"]);e!==void 0&&g!=null&&s(e,["parameters","includeSafetyAttributes"],g);const h=r(t,["includeRaiReason"]);e!==void 0&&h!=null&&s(e,["parameters","includeRaiReason"],h);const y=r(t,["language"]);e!==void 0&&y!=null&&s(e,["parameters","language"],y);const v=r(t,["outputMimeType"]);e!==void 0&&v!=null&&s(e,["parameters","outputOptions","mimeType"],v);const C=r(t,["outputCompressionQuality"]);e!==void 0&&C!=null&&s(e,["parameters","outputOptions","compressionQuality"],C);const S=r(t,["editMode"]);e!==void 0&&S!=null&&s(e,["parameters","editMode"],S);const _=r(t,["baseSteps"]);return e!==void 0&&_!=null&&s(e,["parameters","editConfig","baseSteps"],_),n}function qr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(t,["referenceImages"]);if(l!=null){let d=l;Array.isArray(d)&&(d=d.map(c=>Fr(o,c))),s(e,["instances[0]","referenceImages"],d)}const a=r(t,["config"]);return a!=null&&s(e,["config"],Gr(o,a,e)),e}function Br(o,t,e){const n={},i=r(t,["includeRaiReason"]);e!==void 0&&i!=null&&s(e,["parameters","includeRaiReason"],i);const l=r(t,["outputMimeType"]);e!==void 0&&l!=null&&s(e,["parameters","outputOptions","mimeType"],l);const a=r(t,["outputCompressionQuality"]);e!==void 0&&a!=null&&s(e,["parameters","outputOptions","compressionQuality"],a);const d=r(t,["numberOfImages"]);e!==void 0&&d!=null&&s(e,["parameters","sampleCount"],d);const c=r(t,["mode"]);return e!==void 0&&c!=null&&s(e,["parameters","mode"],c),n}function $r(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["image"]);i!=null&&s(e,["instances[0]","image"],Ee(o,i));const l=r(t,["upscaleFactor"]);l!=null&&s(e,["parameters","upscaleConfig","upscaleFactor"],l);const a=r(t,["config"]);return a!=null&&s(e,["config"],Br(o,a,e)),e}function Hr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],P(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function zr(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);e!==void 0&&l!=null&&s(e,["_query","pageToken"],l);const a=r(t,["filter"]);e!==void 0&&a!=null&&s(e,["_query","filter"],a);const d=r(t,["queryBase"]);return e!==void 0&&d!=null&&s(e,["_url","models_url"],Ht(o,d)),n}function Jr(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],zr(o,n,e)),e}function Kr(o,t,e){const n={},i=r(t,["displayName"]);e!==void 0&&i!=null&&s(e,["displayName"],i);const l=r(t,["description"]);e!==void 0&&l!=null&&s(e,["description"],l);const a=r(t,["defaultCheckpointId"]);return e!==void 0&&a!=null&&s(e,["defaultCheckpointId"],a),n}function Wr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],Kr(o,i,e)),e}function Yr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","name"],P(o,n));const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Or(o,t,e){const n={},i=r(t,["systemInstruction"]);e!==void 0&&i!=null&&s(e,["systemInstruction"],Y(o,k(o,i)));const l=r(t,["tools"]);if(e!==void 0&&l!=null){let d=l;Array.isArray(d)&&(d=d.map(c=>Kt(o,c))),s(e,["tools"],d)}const a=r(t,["generationConfig"]);return e!==void 0&&a!=null&&s(e,["generationConfig"],a),n}function Xr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["contents"]);if(i!=null){let a=G(o,i);Array.isArray(a)&&(a=a.map(d=>Y(o,d))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["config"],Or(o,l,e)),e}function Zr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["contents"]);if(i!=null){let a=G(o,i);Array.isArray(a)&&(a=a.map(d=>Y(o,d))),s(e,["contents"],a)}const l=r(t,["config"]);return l!=null&&s(e,["config"],l),e}function Qr(o,t,e){const n={},i=r(t,["numberOfVideos"]);e!==void 0&&i!=null&&s(e,["parameters","sampleCount"],i);const l=r(t,["outputGcsUri"]);e!==void 0&&l!=null&&s(e,["parameters","storageUri"],l);const a=r(t,["fps"]);e!==void 0&&a!=null&&s(e,["parameters","fps"],a);const d=r(t,["durationSeconds"]);e!==void 0&&d!=null&&s(e,["parameters","durationSeconds"],d);const c=r(t,["seed"]);e!==void 0&&c!=null&&s(e,["parameters","seed"],c);const u=r(t,["aspectRatio"]);e!==void 0&&u!=null&&s(e,["parameters","aspectRatio"],u);const f=r(t,["resolution"]);e!==void 0&&f!=null&&s(e,["parameters","resolution"],f);const p=r(t,["personGeneration"]);e!==void 0&&p!=null&&s(e,["parameters","personGeneration"],p);const g=r(t,["pubsubTopic"]);e!==void 0&&g!=null&&s(e,["parameters","pubsubTopic"],g);const h=r(t,["negativePrompt"]);e!==void 0&&h!=null&&s(e,["parameters","negativePrompt"],h);const y=r(t,["enhancePrompt"]);return e!==void 0&&y!=null&&s(e,["parameters","enhancePrompt"],y),n}function jr(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["_url","model"],P(o,n));const i=r(t,["prompt"]);i!=null&&s(e,["instances[0]","prompt"],i);const l=r(t,["image"]);l!=null&&s(e,["instances[0]","image"],Ee(o,l));const a=r(t,["config"]);return a!=null&&s(e,["config"],Qr(o,a,e)),e}function es(o,t){const e={},n=r(t,["data"]);n!=null&&s(e,["data"],n);const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function ts(o,t){const e={},n=r(t,["thought"]);n!=null&&s(e,["thought"],n);const i=r(t,["inlineData"]);i!=null&&s(e,["inlineData"],es(o,i));const l=r(t,["codeExecutionResult"]);l!=null&&s(e,["codeExecutionResult"],l);const a=r(t,["executableCode"]);a!=null&&s(e,["executableCode"],a);const d=r(t,["fileData"]);d!=null&&s(e,["fileData"],d);const c=r(t,["functionCall"]);c!=null&&s(e,["functionCall"],c);const u=r(t,["functionResponse"]);u!=null&&s(e,["functionResponse"],u);const f=r(t,["text"]);return f!=null&&s(e,["text"],f),e}function ns(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>ts(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function os(o,t){const e={},n=r(t,["citationSources"]);return n!=null&&s(e,["citations"],n),e}function is(o,t){const e={},n=r(t,["content"]);n!=null&&s(e,["content"],ns(o,n));const i=r(t,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],os(o,i));const l=r(t,["tokenCount"]);l!=null&&s(e,["tokenCount"],l);const a=r(t,["finishReason"]);a!=null&&s(e,["finishReason"],a);const d=r(t,["avgLogprobs"]);d!=null&&s(e,["avgLogprobs"],d);const c=r(t,["groundingMetadata"]);c!=null&&s(e,["groundingMetadata"],c);const u=r(t,["index"]);u!=null&&s(e,["index"],u);const f=r(t,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=r(t,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function xt(o,t){const e={},n=r(t,["candidates"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(c=>is(o,c))),s(e,["candidates"],d)}const i=r(t,["modelVersion"]);i!=null&&s(e,["modelVersion"],i);const l=r(t,["promptFeedback"]);l!=null&&s(e,["promptFeedback"],l);const a=r(t,["usageMetadata"]);return a!=null&&s(e,["usageMetadata"],a),e}function rs(o,t){const e={},n=r(t,["values"]);return n!=null&&s(e,["values"],n),e}function ss(){return{}}function ls(o,t){const e={},n=r(t,["embeddings"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>rs(o,a))),s(e,["embeddings"],l)}return r(t,["metadata"])!=null&&s(e,["metadata"],ss()),e}function as(o,t){const e={},n=r(t,["bytesBase64Encoded"]);n!=null&&s(e,["imageBytes"],B(o,n));const i=r(t,["mimeType"]);return i!=null&&s(e,["mimeType"],i),e}function Wt(o,t){const e={},n=r(t,["safetyAttributes","categories"]);n!=null&&s(e,["categories"],n);const i=r(t,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const l=r(t,["contentType"]);return l!=null&&s(e,["contentType"],l),e}function us(o,t){const e={},n=r(t,["_self"]);n!=null&&s(e,["image"],as(o,n));const i=r(t,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const l=r(t,["_self"]);return l!=null&&s(e,["safetyAttributes"],Wt(o,l)),e}function ds(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>us(o,a))),s(e,["generatedImages"],l)}const i=r(t,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],Wt(o,i)),e}function cs(o,t){const e={},n=r(t,["baseModel"]);n!=null&&s(e,["baseModel"],n);const i=r(t,["createTime"]);i!=null&&s(e,["createTime"],i);const l=r(t,["updateTime"]);return l!=null&&s(e,["updateTime"],l),e}function ye(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["description"]);l!=null&&s(e,["description"],l);const a=r(t,["version"]);a!=null&&s(e,["version"],a);const d=r(t,["_self"]);d!=null&&s(e,["tunedModelInfo"],cs(o,d));const c=r(t,["inputTokenLimit"]);c!=null&&s(e,["inputTokenLimit"],c);const u=r(t,["outputTokenLimit"]);u!=null&&s(e,["outputTokenLimit"],u);const f=r(t,["supportedGenerationMethods"]);return f!=null&&s(e,["supportedActions"],f),e}function fs(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["_self"]);if(i!=null){let l=zt(o,i);Array.isArray(l)&&(l=l.map(a=>ye(o,a))),s(e,["models"],l)}return e}function ps(){return{}}function gs(o,t){const e={},n=r(t,["totalTokens"]);n!=null&&s(e,["totalTokens"],n);const i=r(t,["cachedContentTokenCount"]);return i!=null&&s(e,["cachedContentTokenCount"],i),e}function ms(o,t){const e={},n=r(t,["video","uri"]);n!=null&&s(e,["uri"],n);const i=r(t,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],B(o,i));const l=r(t,["encoding"]);return l!=null&&s(e,["mimeType"],l),e}function hs(o,t){const e={},n=r(t,["_self"]);return n!=null&&s(e,["video"],ms(o,n)),e}function ys(o,t){const e={},n=r(t,["generatedSamples"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>hs(o,d))),s(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const l=r(t,["raiMediaFilteredReasons"]);return l!=null&&s(e,["raiMediaFilteredReasons"],l),e}function vs(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);a!=null&&s(e,["error"],a);const d=r(t,["response","generateVideoResponse"]);return d!=null&&s(e,["response"],ys(o,d)),e}function Ts(o,t){const e={},n=r(t,["displayName"]);n!=null&&s(e,["displayName"],n);const i=r(t,["data"]);i!=null&&s(e,["data"],i);const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function Cs(o,t){const e={},n=r(t,["videoMetadata"]);n!=null&&s(e,["videoMetadata"],n);const i=r(t,["thought"]);i!=null&&s(e,["thought"],i);const l=r(t,["inlineData"]);l!=null&&s(e,["inlineData"],Ts(o,l));const a=r(t,["codeExecutionResult"]);a!=null&&s(e,["codeExecutionResult"],a);const d=r(t,["executableCode"]);d!=null&&s(e,["executableCode"],d);const c=r(t,["fileData"]);c!=null&&s(e,["fileData"],c);const u=r(t,["functionCall"]);u!=null&&s(e,["functionCall"],u);const f=r(t,["functionResponse"]);f!=null&&s(e,["functionResponse"],f);const p=r(t,["text"]);return p!=null&&s(e,["text"],p),e}function Es(o,t){const e={},n=r(t,["parts"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Cs(o,a))),s(e,["parts"],l)}const i=r(t,["role"]);return i!=null&&s(e,["role"],i),e}function Is(o,t){const e={},n=r(t,["citations"]);return n!=null&&s(e,["citations"],n),e}function _s(o,t){const e={},n=r(t,["content"]);n!=null&&s(e,["content"],Es(o,n));const i=r(t,["citationMetadata"]);i!=null&&s(e,["citationMetadata"],Is(o,i));const l=r(t,["finishMessage"]);l!=null&&s(e,["finishMessage"],l);const a=r(t,["finishReason"]);a!=null&&s(e,["finishReason"],a);const d=r(t,["avgLogprobs"]);d!=null&&s(e,["avgLogprobs"],d);const c=r(t,["groundingMetadata"]);c!=null&&s(e,["groundingMetadata"],c);const u=r(t,["index"]);u!=null&&s(e,["index"],u);const f=r(t,["logprobsResult"]);f!=null&&s(e,["logprobsResult"],f);const p=r(t,["safetyRatings"]);return p!=null&&s(e,["safetyRatings"],p),e}function Pt(o,t){const e={},n=r(t,["candidates"]);if(n!=null){let u=n;Array.isArray(u)&&(u=u.map(f=>_s(o,f))),s(e,["candidates"],u)}const i=r(t,["createTime"]);i!=null&&s(e,["createTime"],i);const l=r(t,["responseId"]);l!=null&&s(e,["responseId"],l);const a=r(t,["modelVersion"]);a!=null&&s(e,["modelVersion"],a);const d=r(t,["promptFeedback"]);d!=null&&s(e,["promptFeedback"],d);const c=r(t,["usageMetadata"]);return c!=null&&s(e,["usageMetadata"],c),e}function Ss(o,t){const e={},n=r(t,["truncated"]);n!=null&&s(e,["truncated"],n);const i=r(t,["token_count"]);return i!=null&&s(e,["tokenCount"],i),e}function As(o,t){const e={},n=r(t,["values"]);n!=null&&s(e,["values"],n);const i=r(t,["statistics"]);return i!=null&&s(e,["statistics"],Ss(o,i)),e}function ws(o,t){const e={},n=r(t,["billableCharacterCount"]);return n!=null&&s(e,["billableCharacterCount"],n),e}function Ms(o,t){const e={},n=r(t,["predictions[]","embeddings"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>As(o,a))),s(e,["embeddings"],l)}const i=r(t,["metadata"]);return i!=null&&s(e,["metadata"],ws(o,i)),e}function xs(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&s(e,["gcsUri"],n);const i=r(t,["bytesBase64Encoded"]);i!=null&&s(e,["imageBytes"],B(o,i));const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function Yt(o,t){const e={},n=r(t,["safetyAttributes","categories"]);n!=null&&s(e,["categories"],n);const i=r(t,["safetyAttributes","scores"]);i!=null&&s(e,["scores"],i);const l=r(t,["contentType"]);return l!=null&&s(e,["contentType"],l),e}function Ie(o,t){const e={},n=r(t,["_self"]);n!=null&&s(e,["image"],xs(o,n));const i=r(t,["raiFilteredReason"]);i!=null&&s(e,["raiFilteredReason"],i);const l=r(t,["_self"]);l!=null&&s(e,["safetyAttributes"],Yt(o,l));const a=r(t,["prompt"]);return a!=null&&s(e,["enhancedPrompt"],a),e}function Ps(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(a=>Ie(o,a))),s(e,["generatedImages"],l)}const i=r(t,["positivePromptSafetyAttributes"]);return i!=null&&s(e,["positivePromptSafetyAttributes"],Yt(o,i)),e}function Rs(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>Ie(o,l))),s(e,["generatedImages"],i)}return e}function Ds(o,t){const e={},n=r(t,["predictions"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>Ie(o,l))),s(e,["generatedImages"],i)}return e}function ks(o,t){const e={},n=r(t,["endpoint"]);n!=null&&s(e,["name"],n);const i=r(t,["deployedModelId"]);return i!=null&&s(e,["deployedModelId"],i),e}function Ns(o,t){const e={},n=r(t,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&s(e,["baseModel"],n);const i=r(t,["createTime"]);i!=null&&s(e,["createTime"],i);const l=r(t,["updateTime"]);return l!=null&&s(e,["updateTime"],l),e}function Ls(o,t){const e={},n=r(t,["checkpointId"]);n!=null&&s(e,["checkpointId"],n);const i=r(t,["epoch"]);i!=null&&s(e,["epoch"],i);const l=r(t,["step"]);return l!=null&&s(e,["step"],l),e}function ve(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["displayName"]);i!=null&&s(e,["displayName"],i);const l=r(t,["description"]);l!=null&&s(e,["description"],l);const a=r(t,["versionId"]);a!=null&&s(e,["version"],a);const d=r(t,["deployedModels"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(h=>ks(o,h))),s(e,["endpoints"],g)}const c=r(t,["labels"]);c!=null&&s(e,["labels"],c);const u=r(t,["_self"]);u!=null&&s(e,["tunedModelInfo"],Ns(o,u));const f=r(t,["defaultCheckpointId"]);f!=null&&s(e,["defaultCheckpointId"],f);const p=r(t,["checkpoints"]);if(p!=null){let g=p;Array.isArray(g)&&(g=g.map(h=>Ls(o,h))),s(e,["checkpoints"],g)}return e}function bs(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["_self"]);if(i!=null){let l=zt(o,i);Array.isArray(l)&&(l=l.map(a=>ve(o,a))),s(e,["models"],l)}return e}function Vs(){return{}}function Us(o,t){const e={},n=r(t,["totalTokens"]);return n!=null&&s(e,["totalTokens"],n),e}function Fs(o,t){const e={},n=r(t,["tokensInfo"]);return n!=null&&s(e,["tokensInfo"],n),e}function Gs(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&s(e,["uri"],n);const i=r(t,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],B(o,i));const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function qs(o,t){const e={},n=r(t,["_self"]);return n!=null&&s(e,["video"],Gs(o,n)),e}function Bs(o,t){const e={},n=r(t,["videos"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>qs(o,d))),s(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const l=r(t,["raiMediaFilteredReasons"]);return l!=null&&s(e,["raiMediaFilteredReasons"],l),e}function $s(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);a!=null&&s(e,["error"],a);const d=r(t,["response"]);return d!=null&&s(e,["response"],Bs(o,d)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Hs="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function zs(o,t,e){const n=new lo;let i;if(e.data instanceof Blob?i=JSON.parse(await e.data.text()):i=JSON.parse(e.data),o.isVertexAI()){const l=Li(o,i);Object.assign(n,l)}else{const l=Ni(o,i);Object.assign(n,l)}t(n)}class Js{constructor(t,e,n){this.apiClient=t,this.auth=e,this.webSocketFactory=n}async connect(t){var e,n,i,l;const a=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let c;const u=Os(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())c=`${a}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(u);else{const E=this.apiClient.getApiKey();c=`${a}/ws/google.ai.generativelanguage.${d}.GenerativeService.BidiGenerateContent?key=${E}`}let f=()=>{};const p=new Promise(E=>{f=E}),g=t.callbacks,h=function(){var E;(E=g==null?void 0:g.onopen)===null||E===void 0||E.call(g),f({})},y=this.apiClient,v={onopen:h,onmessage:E=>{zs(y,g.onmessage,E)},onerror:(e=g==null?void 0:g.onerror)!==null&&e!==void 0?e:function(E){},onclose:(n=g==null?void 0:g.onclose)!==null&&n!==void 0?n:function(E){}},C=this.webSocketFactory.create(c,Ys(u),v);C.connect(),await p;let S=P(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&S.startsWith("publishers/")){const E=this.apiClient.getProject(),w=this.apiClient.getLocation();S=`projects/${E}/locations/${w}/`+S}let _={};this.apiClient.isVertexAI()&&((i=t.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(t.config===void 0?t.config={responseModalities:[b.AUDIO]}:t.config.responseModalities=[b.AUDIO]),!((l=t.config)===null||l===void 0)&&l.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const A={model:S,config:t.config,callbacks:t.callbacks};return this.apiClient.isVertexAI()?_=ii(this.apiClient,A):_=oi(this.apiClient,A),delete _.config,C.send(JSON.stringify(_)),new Ws(C,this.apiClient)}}const Ks={turnComplete:!0};class Ws{constructor(t,e){this.conn=t,this.apiClient=e}tLiveClientContent(t,e){if(e.turns!==null&&e.turns!==void 0){let n=[];try{n=G(t,e.turns),t.isVertexAI()?n=n.map(i=>Y(t,i)):n=n.map(i=>de(t,i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof e.turns}'`)}return{clientContent:{turns:n,turnComplete:e.turnComplete}}}return{clientContent:{turnComplete:e.turnComplete}}}tLiveClienttToolResponse(t,e){let n=[];if(e.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(e.functionResponses)?n=e.functionResponses:n=[e.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const l of n){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!t.isVertexAI()&&!("id"in l))throw new Error(Hs)}return{toolResponse:{functionResponses:n}}}sendClientContent(t){t=Object.assign(Object.assign({},Ks),t);const e=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(e))}sendRealtimeInput(t){let e={};this.apiClient.isVertexAI()?e={realtimeInput:di(this.apiClient,t)}:e={realtimeInput:ui(this.apiClient,t)},this.conn.send(JSON.stringify(e))}sendToolResponse(t){if(t.functionResponses==null)throw new Error("Tool response parameters are required.");const e=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(e))}close(){this.conn.close()}}function Ys(o){const t={};return o.forEach((e,n)=>{t[n]=e}),t}function Os(o){const t=new Headers;for(const[e,n]of Object.entries(o))t.append(e,n);return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Xs extends Z{constructor(t){super(),this.apiClient=t,this.generateContent=async e=>await this.generateContentInternal(e),this.generateContentStream=async e=>await this.generateContentStreamInternal(e),this.generateImages=async e=>await this.generateImagesInternal(e).then(n=>{var i;let l;const a=[];if(n!=null&&n.generatedImages)for(const c of n.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((i=c==null?void 0:c.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?l=c==null?void 0:c.safetyAttributes:a.push(c);let d;return l?d={generatedImages:a,positivePromptSafetyAttributes:l}:d={generatedImages:a},d}),this.list=async e=>{var n;const a={config:Object.assign(Object.assign({},{queryBase:!0}),e==null?void 0:e.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((n=a.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new ue(W.PAGED_ITEM_MODELS,d=>this.listInternal(d),await this.listInternal(a),a)},this.editImage=async e=>{const n={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(n.referenceImages=e.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async e=>{let n={numberOfImages:1,mode:"upscale"};e.config&&(n=Object.assign(Object.assign({},n),e.config));const i={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:n};return await this.upscaleImageInternal(i)}}async generateContentInternal(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Mt(this.apiClient,t);return d=I("{model}:generateContent",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Pt(this.apiClient,f),g=new Q;return Object.assign(g,p),g})}else{const u=wt(this.apiClient,t);return d=I("{model}:generateContent",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=xt(this.apiClient,f),g=new Q;return Object.assign(g,p),g})}}async generateContentStreamInternal(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Mt(this.apiClient,t);d=I("{model}:streamGenerateContent?alt=sse",u._url),c=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return a=f.requestStream({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}),a.then(function(p){return re(this,arguments,function*(){var g,h,y,v;try{for(var C=!0,S=me(p),_;_=yield R(S.next()),g=_.done,!g;C=!0){v=_.value,C=!1;const E=Pt(f,yield R(v.json())),w=new Q;Object.assign(w,E),yield yield R(w)}}catch(A){h={error:A}}finally{try{!C&&!g&&(y=S.return)&&(yield R(y.call(S)))}finally{if(h)throw h.error}}})})}else{const u=wt(this.apiClient,t);d=I("{model}:streamGenerateContent?alt=sse",u._url),c=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return a=f.requestStream({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}),a.then(function(p){return re(this,arguments,function*(){var g,h,y,v;try{for(var C=!0,S=me(p),_;_=yield R(S.next()),g=_.done,!g;C=!0){v=_.value,C=!1;const E=xt(f,yield R(v.json())),w=new Q;Object.assign(w,E),yield yield R(w)}}catch(A){h={error:A}}finally{try{!C&&!g&&(y=S.return)&&(yield R(y.call(S)))}finally{if(h)throw h.error}}})})}}async embedContent(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Dr(this.apiClient,t);return d=I("{model}:predict",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Ms(this.apiClient,f),g=new pt;return Object.assign(g,p),g})}else{const u=Xi(this.apiClient,t);return d=I("{model}:batchEmbedContents",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=ls(this.apiClient,f),g=new pt;return Object.assign(g,p),g})}}async generateImagesInternal(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Nr(this.apiClient,t);return d=I("{model}:predict",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Ps(this.apiClient,f),g=new gt;return Object.assign(g,p),g})}else{const u=Qi(this.apiClient,t);return d=I("{model}:predict",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=ds(this.apiClient,f),g=new gt;return Object.assign(g,p),g})}}async editImageInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI()){const d=qr(this.apiClient,t);return l=I("{model}:predict",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>{const u=Rs(this.apiClient,c),f=new to;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI()){const d=$r(this.apiClient,t);return l=I("{model}:predict",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>{const u=Ds(this.apiClient,c),f=new no;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Hr(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>ve(this.apiClient,f))}else{const u=ji(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>ye(this.apiClient,f))}}async listInternal(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Jr(this.apiClient,t);return d=I("{models_url}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=bs(this.apiClient,f),g=new mt;return Object.assign(g,p),g})}else{const u=tr(this.apiClient,t);return d=I("{models_url}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=fs(this.apiClient,f),g=new mt;return Object.assign(g,p),g})}}async update(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Wr(this.apiClient,t);return d=I("{model}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>ve(this.apiClient,f))}else{const u=or(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>ye(this.apiClient,f))}}async delete(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Yr(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(()=>{const f=Vs(),p=new ht;return Object.assign(p,f),p})}else{const u=ir(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(()=>{const f=ps(),p=new ht;return Object.assign(p,f),p})}}async countTokens(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Xr(this.apiClient,t);return d=I("{model}:countTokens",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Us(this.apiClient,f),g=new yt;return Object.assign(g,p),g})}else{const u=sr(this.apiClient,t);return d=I("{model}:countTokens",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=gs(this.apiClient,f),g=new yt;return Object.assign(g,p),g})}}async computeTokens(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI()){const d=Zr(this.apiClient,t);return l=I("{model}:computeTokens",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>{const u=Fs(this.apiClient,c),f=new oo;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=jr(this.apiClient,t);return d=I("{model}:predictLongRunning",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>$s(this.apiClient,f))}else{const u=ur(this.apiClient,t);return d=I("{model}:predictLongRunning",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>vs(this.apiClient,f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zs(o,t){const e={},n=r(t,["operationName"]);n!=null&&s(e,["_url","operationName"],n);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Qs(o,t){const e={},n=r(t,["operationName"]);n!=null&&s(e,["_url","operationName"],n);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function js(o,t){const e={},n=r(t,["operationName"]);n!=null&&s(e,["operationName"],n);const i=r(t,["resourceName"]);i!=null&&s(e,["_url","resourceName"],i);const l=r(t,["config"]);return l!=null&&s(e,["config"],l),e}function el(o,t){const e={},n=r(t,["video","uri"]);n!=null&&s(e,["uri"],n);const i=r(t,["video","encodedVideo"]);i!=null&&s(e,["videoBytes"],B(o,i));const l=r(t,["encoding"]);return l!=null&&s(e,["mimeType"],l),e}function tl(o,t){const e={},n=r(t,["_self"]);return n!=null&&s(e,["video"],el(o,n)),e}function nl(o,t){const e={},n=r(t,["generatedSamples"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>tl(o,d))),s(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const l=r(t,["raiMediaFilteredReasons"]);return l!=null&&s(e,["raiMediaFilteredReasons"],l),e}function ol(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);a!=null&&s(e,["error"],a);const d=r(t,["response","generateVideoResponse"]);return d!=null&&s(e,["response"],nl(o,d)),e}function il(o,t){const e={},n=r(t,["gcsUri"]);n!=null&&s(e,["uri"],n);const i=r(t,["bytesBase64Encoded"]);i!=null&&s(e,["videoBytes"],B(o,i));const l=r(t,["mimeType"]);return l!=null&&s(e,["mimeType"],l),e}function rl(o,t){const e={},n=r(t,["_self"]);return n!=null&&s(e,["video"],il(o,n)),e}function sl(o,t){const e={},n=r(t,["videos"]);if(n!=null){let a=n;Array.isArray(a)&&(a=a.map(d=>rl(o,d))),s(e,["generatedVideos"],a)}const i=r(t,["raiMediaFilteredCount"]);i!=null&&s(e,["raiMediaFilteredCount"],i);const l=r(t,["raiMediaFilteredReasons"]);return l!=null&&s(e,["raiMediaFilteredReasons"],l),e}function Rt(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);a!=null&&s(e,["error"],a);const d=r(t,["response"]);return d!=null&&s(e,["response"],sl(o,d)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ll extends Z{constructor(t){super(),this.apiClient=t}async getVideosOperation(t){const e=t.operation,n=t.config;if(e.name===void 0||e.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=e.name.split("/operations/")[0];let l;return n&&"httpOptions"in n&&(l=n.httpOptions),this.fetchPredictVideosOperationInternal({operationName:e.name,resourceName:i,config:{httpOptions:l}})}else return this.getVideosOperationInternal({operationName:e.name,config:n})}async getVideosOperationInternal(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Qs(this.apiClient,t);return d=I("{operationName}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>Rt(this.apiClient,f))}else{const u=Zs(this.apiClient,t);return d=I("{operationName}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>ol(this.apiClient,f))}}async fetchPredictVideosOperationInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI()){const d=js(this.apiClient,t);return l=I("{resourceName}:fetchPredictOperation",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>Rt(this.apiClient,c))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const al="Content-Type",ul="X-Server-Timeout",dl="User-Agent",cl="x-goog-api-client",fl="0.14.1",pl=`google-genai-sdk/${fl}`,gl="v1beta1",ml="v1beta",Dt=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Ot extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ClientError"}}class Te extends Error{constructor(t,e){e?super(t,{cause:e}):super(t,{cause:new Error().stack}),this.message=t,this.name="ServerError"}}class hl{constructor(t){var e,n;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(e=this.clientOptions.apiVersion)!==null&&e!==void 0?e:gl,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:ml,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,t.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var t;return(t=this.clientOptions.vertexai)!==null&&t!==void 0?t:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||t.baseUrl===void 0||t.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&t.apiVersion!==""&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),e=new URL(t);return e.protocol=e.protocol=="http:"?"ws":"wss",e.toString()}setBaseUrl(t){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=t;else throw new Error("HTTP options are not correctly set.")}constructUrl(t,e,n){const i=[this.getRequestUrlInternal(e)];return n&&i.push(this.getBaseResourcePath()),t!==""&&i.push(t),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(t){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||t.path.startsWith("projects/")||t.httpMethod==="GET"&&t.path.startsWith("publishers/google/models"))}async request(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);if(t.queryParams)for(const[a,d]of Object.entries(t.queryParams))i.searchParams.append(a,String(d));let l={};if(t.httpMethod==="GET"){if(t.body&&t.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else l.body=t.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,e,t.abortSignal),this.unaryApiCall(i,l,t.httpMethod)}patchHttpOptions(t,e){const n=JSON.parse(JSON.stringify(t));for(const[i,l]of Object.entries(e))typeof l=="object"?n[i]=Object.assign(Object.assign({},n[i]),l):l!==void 0&&(n[i]=l);return n}async requestStream(t){let e=this.clientOptions.httpOptions;t.httpOptions&&(e=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const n=this.shouldPrependVertexProjectPath(t),i=this.constructUrl(t.path,e,n);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let l={};return l.body=t.body,l=await this.includeExtraHttpOptionsToRequestInit(l,e,t.abortSignal),this.streamApiCall(i,l,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,e,n){if(e&&e.timeout||n){const i=new AbortController,l=i.signal;e.timeout&&(e==null?void 0:e.timeout)>0&&setTimeout(()=>i.abort(),e.timeout),n&&n.addEventListener("abort",()=>{i.abort()}),t.signal=l}return t.headers=await this.getHeadersInternal(e),t}async unaryApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await kt(i),new ge(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(t,e,n){return this.apiCall(t.toString(),Object.assign(Object.assign({},e),{method:n})).then(async i=>(await kt(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(t){var e;return re(this,arguments,function*(){const i=(e=t==null?void 0:t.body)===null||e===void 0?void 0:e.getReader(),l=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let a="";for(;;){const{done:d,value:c}=yield R(i.read());if(d){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const u=l.decode(c);try{const p=JSON.parse(u);if("error"in p){const g=JSON.parse(JSON.stringify(p.error)),h=g.status,y=g.code,v=`got status: ${h}. ${JSON.stringify(p)}`;if(y>=400&&y<500)throw new Ot(v);if(y>=500&&y<600)throw new Te(v)}}catch(p){const g=p;if(g.name==="ClientError"||g.name==="ServerError")throw p}a+=u;let f=a.match(Dt);for(;f;){const p=f[1];try{const g=new Response(p,{headers:t==null?void 0:t.headers,status:t==null?void 0:t.status,statusText:t==null?void 0:t.statusText});yield yield R(new ge(g)),a=a.slice(f[0].length),f=a.match(Dt)}catch(g){throw new Error(`exception parsing stream chunk ${p}. ${g}`)}}}}finally{i.releaseLock()}})}async apiCall(t,e){return fetch(t,e).catch(n=>{throw new Error(`exception ${n} sending request`)})}getDefaultHeaders(){const t={},e=pl+" "+this.clientOptions.userAgentExtra;return t[dl]=e,t[cl]=e,t[al]="application/json",t}async getHeadersInternal(t){const e=new Headers;if(t&&t.headers){for(const[n,i]of Object.entries(t.headers))e.append(n,i);t.timeout&&t.timeout>0&&e.append(ul,String(Math.ceil(t.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(e),e}async uploadFile(t,e){var n;const i={};e!=null&&(i.mimeType=e.mimeType,i.name=e.name,i.displayName=e.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const l=this.clientOptions.uploader,a=await l.stat(t);i.sizeBytes=String(a.size);const d=(n=e==null?void 0:e.mimeType)!==null&&n!==void 0?n:a.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=d;const c=await this.fetchUploadUrl(i,e);return l.upload(t,c,this)}async downloadFile(t){await this.clientOptions.downloader.download(t,this)}async fetchUploadUrl(t,e){var n;let i={};e!=null&&e.httpOptions?i=e.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${t.mimeType}`}};const l={file:t},a=await this.request({path:I("upload/v1beta/files",l._url),body:JSON.stringify(l),httpMethod:"POST",httpOptions:i});if(!a||!(a!=null&&a.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const d=(n=a==null?void 0:a.headers)===null||n===void 0?void 0:n["x-goog-upload-url"];if(d===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return d}}async function kt(o){var t;if(o===void 0)throw new Te("response is undefined");if(!o.ok){const e=o.status,n=o.statusText;let i;!((t=o.headers.get("content-type"))===null||t===void 0)&&t.includes("application/json")?i=await o.json():i={error:{message:await o.text(),code:o.status,status:o.statusText}};const l=`got status: ${e} ${n}. ${JSON.stringify(i)}`;throw e>=400&&e<500?new Ot(l):e>=500&&e<600?new Te(l):new Error(l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yl(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],n);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function vl(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);e!==void 0&&l!=null&&s(e,["_query","pageToken"],l);const a=r(t,["filter"]);return e!==void 0&&a!=null&&s(e,["_query","filter"],a),n}function Tl(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],vl(o,n,e)),e}function Cl(o,t){const e={},n=r(t,["textInput"]);n!=null&&s(e,["textInput"],n);const i=r(t,["output"]);return i!=null&&s(e,["output"],i),e}function El(o,t){const e={};if(r(t,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=r(t,["examples"]);if(n!=null){let i=n;Array.isArray(i)&&(i=i.map(l=>Cl(o,l))),s(e,["examples","examples"],i)}return e}function Il(o,t,e){const n={};if(r(t,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=r(t,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&s(e,["displayName"],i),r(t,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const l=r(t,["epochCount"]);e!==void 0&&l!=null&&s(e,["tuningTask","hyperparameters","epochCount"],l);const a=r(t,["learningRateMultiplier"]);if(a!=null&&s(n,["tuningTask","hyperparameters","learningRateMultiplier"],a),r(t,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(r(t,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const d=r(t,["batchSize"]);e!==void 0&&d!=null&&s(e,["tuningTask","hyperparameters","batchSize"],d);const c=r(t,["learningRate"]);return e!==void 0&&c!=null&&s(e,["tuningTask","hyperparameters","learningRate"],c),n}function _l(o,t){const e={},n=r(t,["baseModel"]);n!=null&&s(e,["baseModel"],n);const i=r(t,["trainingDataset"]);i!=null&&s(e,["tuningTask","trainingData"],El(o,i));const l=r(t,["config"]);return l!=null&&s(e,["config"],Il(o,l,e)),e}function Sl(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["_url","name"],n);const i=r(t,["config"]);return i!=null&&s(e,["config"],i),e}function Al(o,t,e){const n={},i=r(t,["pageSize"]);e!==void 0&&i!=null&&s(e,["_query","pageSize"],i);const l=r(t,["pageToken"]);e!==void 0&&l!=null&&s(e,["_query","pageToken"],l);const a=r(t,["filter"]);return e!==void 0&&a!=null&&s(e,["_query","filter"],a),n}function wl(o,t){const e={},n=r(t,["config"]);return n!=null&&s(e,["config"],Al(o,n,e)),e}function Ml(o,t,e){const n={},i=r(t,["gcsUri"]);if(e!==void 0&&i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],i),r(t,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function xl(o,t){const e={},n=r(t,["gcsUri"]);return n!=null&&s(e,["validationDatasetUri"],n),e}function Pl(o,t,e){const n={},i=r(t,["validationDataset"]);e!==void 0&&i!=null&&s(e,["supervisedTuningSpec"],xl(o,i));const l=r(t,["tunedModelDisplayName"]);e!==void 0&&l!=null&&s(e,["tunedModelDisplayName"],l);const a=r(t,["description"]);e!==void 0&&a!=null&&s(e,["description"],a);const d=r(t,["epochCount"]);e!==void 0&&d!=null&&s(e,["supervisedTuningSpec","hyperParameters","epochCount"],d);const c=r(t,["learningRateMultiplier"]);e!==void 0&&c!=null&&s(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],c);const u=r(t,["exportLastCheckpointOnly"]);e!==void 0&&u!=null&&s(e,["supervisedTuningSpec","exportLastCheckpointOnly"],u);const f=r(t,["adapterSize"]);if(e!==void 0&&f!=null&&s(e,["supervisedTuningSpec","hyperParameters","adapterSize"],f),r(t,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(r(t,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return n}function Rl(o,t){const e={},n=r(t,["baseModel"]);n!=null&&s(e,["baseModel"],n);const i=r(t,["trainingDataset"]);i!=null&&s(e,["supervisedTuningSpec","trainingDatasetUri"],Ml(o,i,e));const l=r(t,["config"]);return l!=null&&s(e,["config"],Pl(o,l,e)),e}function Dl(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["model"],n);const i=r(t,["name"]);return i!=null&&s(e,["endpoint"],i),e}function Xt(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["state"]);i!=null&&s(e,["state"],Bt(o,i));const l=r(t,["createTime"]);l!=null&&s(e,["createTime"],l);const a=r(t,["tuningTask","startTime"]);a!=null&&s(e,["startTime"],a);const d=r(t,["tuningTask","completeTime"]);d!=null&&s(e,["endTime"],d);const c=r(t,["updateTime"]);c!=null&&s(e,["updateTime"],c);const u=r(t,["description"]);u!=null&&s(e,["description"],u);const f=r(t,["baseModel"]);f!=null&&s(e,["baseModel"],f);const p=r(t,["_self"]);p!=null&&s(e,["tunedModel"],Dl(o,p));const g=r(t,["distillationSpec"]);g!=null&&s(e,["distillationSpec"],g);const h=r(t,["experiment"]);h!=null&&s(e,["experiment"],h);const y=r(t,["labels"]);y!=null&&s(e,["labels"],y);const v=r(t,["pipelineJob"]);v!=null&&s(e,["pipelineJob"],v);const C=r(t,["tunedModelDisplayName"]);return C!=null&&s(e,["tunedModelDisplayName"],C),e}function kl(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["tunedModels"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>Xt(o,a))),s(e,["tuningJobs"],l)}return e}function Nl(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["metadata"]);i!=null&&s(e,["metadata"],i);const l=r(t,["done"]);l!=null&&s(e,["done"],l);const a=r(t,["error"]);return a!=null&&s(e,["error"],a),e}function Ll(o,t){const e={},n=r(t,["checkpointId"]);n!=null&&s(e,["checkpointId"],n);const i=r(t,["epoch"]);i!=null&&s(e,["epoch"],i);const l=r(t,["step"]);l!=null&&s(e,["step"],l);const a=r(t,["endpoint"]);return a!=null&&s(e,["endpoint"],a),e}function bl(o,t){const e={},n=r(t,["model"]);n!=null&&s(e,["model"],n);const i=r(t,["endpoint"]);i!=null&&s(e,["endpoint"],i);const l=r(t,["checkpoints"]);if(l!=null){let a=l;Array.isArray(a)&&(a=a.map(d=>Ll(o,d))),s(e,["checkpoints"],a)}return e}function Ce(o,t){const e={},n=r(t,["name"]);n!=null&&s(e,["name"],n);const i=r(t,["state"]);i!=null&&s(e,["state"],Bt(o,i));const l=r(t,["createTime"]);l!=null&&s(e,["createTime"],l);const a=r(t,["startTime"]);a!=null&&s(e,["startTime"],a);const d=r(t,["endTime"]);d!=null&&s(e,["endTime"],d);const c=r(t,["updateTime"]);c!=null&&s(e,["updateTime"],c);const u=r(t,["error"]);u!=null&&s(e,["error"],u);const f=r(t,["description"]);f!=null&&s(e,["description"],f);const p=r(t,["baseModel"]);p!=null&&s(e,["baseModel"],p);const g=r(t,["tunedModel"]);g!=null&&s(e,["tunedModel"],bl(o,g));const h=r(t,["supervisedTuningSpec"]);h!=null&&s(e,["supervisedTuningSpec"],h);const y=r(t,["tuningDataStats"]);y!=null&&s(e,["tuningDataStats"],y);const v=r(t,["encryptionSpec"]);v!=null&&s(e,["encryptionSpec"],v);const C=r(t,["partnerModelTuningSpec"]);C!=null&&s(e,["partnerModelTuningSpec"],C);const S=r(t,["distillationSpec"]);S!=null&&s(e,["distillationSpec"],S);const _=r(t,["experiment"]);_!=null&&s(e,["experiment"],_);const A=r(t,["labels"]);A!=null&&s(e,["labels"],A);const E=r(t,["pipelineJob"]);E!=null&&s(e,["pipelineJob"],E);const w=r(t,["tunedModelDisplayName"]);return w!=null&&s(e,["tunedModelDisplayName"],w),e}function Vl(o,t){const e={},n=r(t,["nextPageToken"]);n!=null&&s(e,["nextPageToken"],n);const i=r(t,["tuningJobs"]);if(i!=null){let l=i;Array.isArray(l)&&(l=l.map(a=>Ce(o,a))),s(e,["tuningJobs"],l)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ul extends Z{constructor(t){super(),this.apiClient=t,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new ue(W.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(e),e),this.tune=async e=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(e);{const n=await this.tuneMldevInternal(e);let i="";return n.metadata!==void 0&&n.metadata.tunedModel!==void 0?i=n.metadata.tunedModel:n.name!==void 0&&n.name.includes("/operations/")&&(i=n.name.split("/operations/")[0]),{name:i,state:pe.JOB_STATE_QUEUED}}}}async getInternal(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=Sl(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>Ce(this.apiClient,f))}else{const u=yl(this.apiClient,t);return d=I("{name}",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>Xt(this.apiClient,f))}}async listInternal(t){var e,n,i,l;let a,d="",c={};if(this.apiClient.isVertexAI()){const u=wl(this.apiClient,t);return d=I("tuningJobs",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(f=>f.json()),a.then(f=>{const p=Vl(this.apiClient,f),g=new vt;return Object.assign(g,p),g})}else{const u=Tl(this.apiClient,t);return d=I("tunedModels",u._url),c=u._query,delete u.config,delete u._url,delete u._query,a=this.apiClient.request({path:d,queryParams:c,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(i=t.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(l=t.config)===null||l===void 0?void 0:l.abortSignal}).then(f=>f.json()),a.then(f=>{const p=kl(this.apiClient,f),g=new vt;return Object.assign(g,p),g})}}async tuneInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI()){const d=Rl(this.apiClient,t);return l=I("tuningJobs",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>Ce(this.apiClient,c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(t){var e,n;let i,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const d=_l(this.apiClient,t);return l=I("tunedModels",d._url),a=d._query,delete d.config,delete d._url,delete d._query,i=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(e=t.config)===null||e===void 0?void 0:e.httpOptions,abortSignal:(n=t.config)===null||n===void 0?void 0:n.abortSignal}).then(c=>c.json()),i.then(c=>Nl(this.apiClient,c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Fl{async download(t,e){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Gl=1024*1024*8,ql=3,Bl=1e3,$l=2,ce="x-goog-upload-status";async function Hl(o,t,e){var n,i,l;let a=0,d=0,c=new ge(new Response),u="upload";for(a=o.size;d<a;){const p=Math.min(Gl,a-d),g=o.slice(d,d+p);d+p>=a&&(u+=", finalize");let h=0,y=Bl;for(;h<ql&&(c=await e.request({path:"",body:g,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(d),"Content-Length":String(p)}}}),!(!((n=c==null?void 0:c.headers)===null||n===void 0)&&n[ce]));)h++,await Jl(y),y=y*$l;if(d+=p,((i=c==null?void 0:c.headers)===null||i===void 0?void 0:i[ce])!=="active")break;if(a<=d)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const f=await(c==null?void 0:c.json());if(((l=c==null?void 0:c.headers)===null||l===void 0?void 0:l[ce])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}async function zl(o){return{size:o.size,type:o.type}}function Jl(o){return new Promise(t=>setTimeout(t,o))}class Kl{async upload(t,e,n){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await Hl(t,e,n)}async stat(t){if(typeof t=="string")throw new Error("File path is not supported in browser uploader.");return await zl(t)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Wl{create(t,e,n){return new Yl(t,e,n)}}class Yl{constructor(t,e,n){this.url=t,this.headers=e,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(t){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(t)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Nt="x-goog-api-key";class Ol{constructor(t){this.apiKey=t}async addAuthHeaders(t){t.get(Nt)===null&&t.append(Nt,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Xl="gl-node/";class Zl{constructor(t){var e;if(t.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(e=t.vertexai)!==null&&e!==void 0?e:!1,this.apiKey=t.apiKey;const n=rn(t,void 0,void 0);n&&(t.httpOptions?t.httpOptions.baseUrl=n:t.httpOptions={baseUrl:n}),this.apiVersion=t.apiVersion;const i=new Ol(this.apiKey);this.apiClient=new hl({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:t.httpOptions,userAgentExtra:Xl+"web",uploader:new Kl,downloader:new Fl}),this.models=new Xs(this.apiClient),this.live=new Js(this.apiClient,i,new Wl),this.chats=new po(this.models,this.apiClient),this.caches=new ao(this.apiClient),this.files=new wo(this.apiClient),this.operations=new ll(this.apiClient),this.tunings=new Ul(this.apiClient)}}/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
 */const Ql=()=>new Promise((o,t)=>{const e=document.createElement("script");e.src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs",e.type="module",e.onload=o,e.onerror=t,document.head.appendChild(e)}),X=(o,t,e)=>{const n=document.getElementById(o);if(!n){console.log(`Dropzone not found: ${o}`);return}console.log(`Setting up drag and drop for: ${o}`),["dragenter","dragover","dragleave","drop"].forEach(l=>{n.addEventListener(l,i,!1),document.body.addEventListener(l,i,!1)}),["dragenter","dragover"].forEach(l=>{n.addEventListener(l,()=>n.classList.add("drag-over"),!1)}),["dragleave","drop"].forEach(l=>{n.addEventListener(l,()=>n.classList.remove("drag-over"),!1)}),n.addEventListener("drop",l=>{var d;const a=Array.from(((d=l.dataTransfer)==null?void 0:d.files)||[]).filter(c=>c.type.startsWith("image/"));a.length>0&&e(a)},!1);function i(l){l.preventDefault(),l.stopPropagation()}},J=new Zl({apiKey:"AIzaSyC-ntmyrIlXwje5m8lh_ay3fvyBWVZzrYk"}),m={view:"home",isLoading:!1,error:null,userImage:null,clothingImage:null,clothingImages:[],step1ModelImage:null,tryOnStep:1,prompt:"",videoPrompt:"",videoAspectRatio:"9:16",videoLength:4,videoResolution:"720p",videoWithoutAudio:!1,resultImage:null,resultVideoUrl:null,loadingMessage:"Kreiranje magije...",editPrompt:"",originalEditorImage:null,imageHistory:[],redoHistory:[],history:[],activeHistoryTab:"try-on",currentHistoryId:null,generatedCaption:null,captionType:null},$=document.getElementById("app");if(!$)throw new Error("App root not found");const Zt=o=>new Promise((t,e)=>{const n=new Image,i=new FileReader;i.onload=()=>{n.src=i.result},n.onload=()=>{const l=document.createElement("canvas"),a=l.getContext("2d");if(!a){e(new Error("Ne mogu da kreiram canvas"));return}const{width:d,height:c}=n,u=Math.min(d,c);l.width=u,l.height=u;let f=0,p=0;d>c?(f=(d-u)/2,p=0):c>d&&(f=0,p=Math.max(0,(c-u)/3)),a.drawImage(n,f,p,u,u,0,0,u,u);const h=l.toDataURL(o.type||"image/png").split(",")[1];console.log(`🔲 Smart cropped: ${d}x${c} → ${u}x${u}`),t({base64:h,mimeType:o.type||"image/png"})},n.onerror=()=>e(new Error("Ne mogu da učitam sliku")),i.onerror=()=>e(new Error("Ne mogu da pročitam fajl")),i.readAsDataURL(o)}),jl=(o,t,e)=>{const n=new Image;n.crossOrigin="anonymous",n.src=o,n.onload=()=>{const i=n.width,l=n.height,a=i/l;let d=0,c=0,u=i,f=l;t<a?(u=l*t,d=(i-u)/2):t>a&&(f=i/t,c=(l-f)/2);const p=document.createElement("canvas");p.width=u,p.height=f;const g=p.getContext("2d");if(!g){T({error:"Greška pri kreiranju canvasa za isecanje slike."});return}g.drawImage(n,d,c,u,f,0,0,u,f);const h=document.createElement("a");h.href=p.toDataURL("image/png"),h.download=e,document.body.appendChild(h),h.click(),document.body.removeChild(h)},n.onerror=()=>{T({error:"Nije moguće učitati sliku za isecanje."})}},T=o=>{Object.assign(m,o),xe()},_e=async o=>{const t=document.createElement("div");t.id="scanning-popup",t.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    backdrop-filter: blur(10px);
  `;const e=document.createElement("div");e.style.cssText=`
    position: relative;
    width: 400px;
    height: 400px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  `;const n=document.createElement("div");if(n.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
  `,o.length===1){const a=document.createElement("img");a.src=`data:${o[0].mimeType};base64,${o[0].base64}`,a.style.cssText=`
      position: absolute;
      width: 65%;
      height: 65%;
      object-fit: cover;
      border-radius: 15px;
      opacity: 0.25;
      transform: rotate(-6deg);
      top: 10%;
      left: 8%;
    `,n.appendChild(a)}else o.length>1&&o.forEach((a,d)=>{const c=document.createElement("img");c.src=`data:${a.mimeType};base64,${a.base64}`,c.style.cssText=`
        position: absolute;
        width: 45%;
        height: 45%;
        object-fit: cover;
        border-radius: 15px;
        opacity: 0.2;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) translate(${d*20-10}px, ${d*15-7}px);
      `,n.appendChild(c)});const i=document.createElement("div");i.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 5;
  `;try{await Ql();const a=document.createElement("dotlottie-player");a.setAttribute("src","/assets/X6eLd46GUG.lottie"),a.setAttribute("background","transparent"),a.setAttribute("speed","1"),a.setAttribute("loop",""),a.setAttribute("autoplay",""),a.style.cssText=`
      width: 300px;
      height: 300px;
    `,i.appendChild(a)}catch{const d=document.createElement("div");d.style.cssText=`
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    `,i.appendChild(d)}const l=document.createElement("div");return l.id="scanning-status",l.style.cssText=`
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: 18px;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    text-align: center;
  `,l.textContent="Masterbot skenira garderobu...",e.appendChild(n),e.appendChild(i),e.appendChild(l),t.appendChild(e),document.body.appendChild(t),{updateStatus:a=>{const d=document.getElementById("scanning-status");d&&(d.textContent=a)},close:()=>{const a=document.getElementById("scanning-popup");a&&a.remove()}}},Qt=document.createElement("style");Qt.textContent=`
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
`;document.head.appendChild(Qt);const jt=()=>{T({error:null,clothingImages:[],prompt:"",videoPrompt:"",videoAspectRatio:"9:16",videoLength:4,videoResolution:"720p",videoWithoutAudio:!1,resultImage:null,resultVideoUrl:null,originalEditorImage:null,editPrompt:"",imageHistory:[],currentHistoryId:null,generatedCaption:null,captionType:null})},te=async(o,t)=>{var i;const n=(i=o.target.files)==null?void 0:i[0];if(n)try{T({isLoading:!0,loadingMessage:"Pametno isecanje slike na kvadrat..."});const{base64:l,mimeType:a}=await Zt(n);T({[t]:{file:n,base64:l,mimeType:a},error:null,isLoading:!1})}catch{T({error:"Greška pri obradi slike. Pokušajte sa drugim formatom.",isLoading:!1})}},se=5,Lt=async o=>{const t=o.target,e=t.files;if(e){if(m.clothingImages.length+e.length>se){T({error:`Možete dodati najviše ${se} slika.`}),t.value="";return}T({isLoading:!0,loadingMessage:"Pametno isecanje slika na kvadrat..."});try{const n=await Promise.all(Array.from(e).map(async i=>{const{base64:l,mimeType:a}=await Zt(i);return{file:i,base64:l,mimeType:a}}));T({clothingImages:[...m.clothingImages,...n],error:null})}catch{T({error:"Greška pri obradi slika. Pokušajte sa drugim formatom."})}finally{t.value="",T({isLoading:!1,loadingMessage:"Kreiranje magije..."})}}},ea=o=>{const t=m.clothingImages.filter((e,n)=>n!==o);T({clothingImages:t})},O=o=>(console.error("Originalna greška:",o),"Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis."),ta=()=>{try{const o=localStorage.getItem("masterbot-history");return o?JSON.parse(o):[]}catch(o){return console.error("Error loading history:",o),[]}},Se=o=>{try{localStorage.setItem("masterbot-history",JSON.stringify(o))}catch(t){if(console.error("Error saving history:",t),t instanceof DOMException&&(t.name==="QuotaExceededError"||t.name==="NS_ERROR_DOM_QUOTA_REACHED")){console.warn("LocalStorage quota exceeded. Trimming history...");let e=[...o],n=!1;for(;!n&&e.length>0;){e=e.slice(0,e.length-1);try{localStorage.setItem("masterbot-history",JSON.stringify(e)),n=!0}catch{}}e.length!==o.length&&T({history:e})}}},en=o=>{const t={...o,id:Date.now().toString()+Math.random().toString(36).substr(2,9),timestamp:Date.now()},e=[t,...m.history].slice(0,50);return T({history:e}),Se(e),t},na=(o,t)=>{const e=m.history.map(n=>n.id===o?{...n,...t,timestamp:Date.now()}:n).sort((n,i)=>i.timestamp-n.timestamp);JSON.stringify(e)!==JSON.stringify(m.history)&&(T({history:e}),Se(e))},oa=o=>{const t=m.history.filter(e=>e.id!==o);T({history:t}),Se(t)},ia=async()=>{var e,n,i;if(!m.userImage){T({error:"Molimo vas odaberite vašu fotografiju."});return}const o=[{base64:m.userImage.base64,mimeType:m.userImage.mimeType}],t=await _e(o);T({error:null,step1ModelImage:null});try{t.updateStatus("Masterbot analizira fotografiju...");const l={inlineData:{data:m.userImage.base64,mimeType:m.userImage.mimeType}},a={text:"Convert this person to wearing appropriate swimwear. If the person is female, dress them in a bikini with strapless top (no bra straps or halter neck). If the person is male, dress them in swim trunks. Keep the same pose, background, and lighting as the original image. Make it look natural and realistic."};await new Promise(u=>setTimeout(u,800)),t.updateStatus("Masterbot kreira model...");const d=await J.models.generateContent({model:"gemini-2.5-flash-image-preview",contents:{parts:[l,a]},config:{responseModalities:[b.IMAGE,b.TEXT],imageConfig:{numberOfImages:1}}});t.updateStatus("Sve spremno! 🎉");const c=(i=(n=(e=d.candidates)==null?void 0:e[0])==null?void 0:n.content)==null?void 0:i.parts.find(u=>u.inlineData);if(c!=null&&c.inlineData){const f=`data:image/png;base64,${c.inlineData.data}`;setTimeout(()=>{t.close(),T({step1ModelImage:f,tryOnStep:2})},1200)}else throw t.close(),new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniju fotografiju.")}catch(l){t.close(),T({error:O(l)})}},ra=async()=>{var e,n,i;if(!m.step1ModelImage||!m.clothingImage){T({error:"Molimo vas odaberite obe slike."});return}const o=[{base64:m.step1ModelImage.split(",")[1],mimeType:"image/png"},{base64:m.clothingImage.base64,mimeType:m.clothingImage.mimeType}],t=await _e(o);T({error:null,resultImage:null,resultVideoUrl:null});try{t.updateStatus("Masterbot analizira fotografiju...");const l={inlineData:{data:m.step1ModelImage.split(",")[1],mimeType:"image/png"}},a={inlineData:{data:m.clothingImage.base64,mimeType:m.clothingImage.mimeType}},d={text:"Remove ALL the clothing from the first image and take the clothing from the second image and realistically place it onto the person in the first image. The final image should only show the person wearing the new clothing in the original setting. Preserve the original design, colors, and details of each clothing item precisely."};await new Promise(f=>setTimeout(f,800)),t.updateStatus("Masterbot kreira model...");const c=await J.models.generateContent({model:"gemini-2.5-flash-image-preview",contents:{parts:[l,a,d]},config:{responseModalities:[b.IMAGE,b.TEXT],imageConfig:{numberOfImages:1}}});t.updateStatus("Sve spremno! 🎉");const u=(i=(n=(e=c.candidates)==null?void 0:e[0])==null?void 0:n.content)==null?void 0:i.parts.find(f=>f.inlineData);if(u!=null&&u.inlineData){const p=`data:image/png;base64,${u.inlineData.data}`;setTimeout(()=>{t.close(),T({resultImage:p}),en({type:"try-on",result:p})},1200)}else throw t.close(),new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.")}catch(l){t.close(),T({error:O(l)})}},Ae=async o=>{var t,e,n;if(console.log("🎯 generateAICaption called with:",o),console.log("🎯 state.resultImage exists:",!!m.resultImage),!m.resultImage){T({error:"Nema slike za generisanje opisa."});return}T({isLoading:!0,error:null,captionType:o,generatedCaption:null});try{const i={inlineData:{data:m.resultImage.split(",")[1],mimeType:"image/png"}};let l="";switch(o){case"facebook":l="Create an engaging Facebook post caption for this fashion image. Make it trendy, include relevant hashtags, and encourage engagement. Write in Serbian language.";break;case"instagram":l="Create an Instagram caption for this fashion image. Make it stylish, include fashion hashtags, and write in Serbian language. Keep it engaging and trendy.";break;case"shop":l="Create a product description for this fashion item for an online shop. Include material details, style description, and selling points. Write in Serbian language.";break}const a={text:l};console.log("🎯 Calling AI with prompt:",l);const c=(n=(e=(t=(await J.models.generateContent({model:"gemini-2.5-flash-image-preview",contents:{parts:[i,a]},config:{responseModalities:[b.TEXT]}})).candidates)==null?void 0:t[0])==null?void 0:e.content)==null?void 0:n.parts.find(u=>u.text);if(c!=null&&c.text){console.log("🎯 Generated caption:",c.text);let u=c.text.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').trim();T({generatedCaption:u,isLoading:!1})}else throw new Error("Masterbot nije uspeo da generiše opis.")}catch(i){console.error("🎯 Error generating caption:",i),T({error:O(i),isLoading:!1})}},sa=async()=>{var t,e,n;if(!m.clothingImages.length||!m.prompt){T({error:"Molimo vas odaberite sliku odeće i unesite opis."});return}const o=await _e(m.clothingImages);T({error:null,resultImage:null,resultVideoUrl:null});try{o.updateStatus("Masterbot analizira fotografiju...");const i=m.clothingImages.map(f=>({inlineData:{data:f.base64,mimeType:f.mimeType}})),a="Ti si AI asistent za modni dizajn. Tvoj zadatak je da kreiraš fotorealističnog AI modela na osnovu opisa korisnika i slika odeće koje su date. Model mora uvek biti evropskog porekla (caucasian/european ethnicity). Važno: Fokusiraj se isključivo na generisanje modela prema opisu. Odeća i aksesoari sa dodatih slika moraju ostati POTPUNO ISTI, bez ikakvih izmena na detaljima, logotipima, teksturama ili bojama. Ne dodaji i ne uklanjaj ništa sa garderobe.",d={text:m.prompt};await new Promise(f=>setTimeout(f,1500)),o.updateStatus("Masterbot kreira model...");const c=await J.models.generateContent({model:"gemini-2.5-flash-image-preview",system:{parts:[{text:a}]},contents:{parts:[...i,d]},config:{responseModalities:[b.IMAGE,b.TEXT],imageConfig:{aspectRatio:"1:1",numberOfImages:1}}});o.updateStatus("Sve spremno! 🎉");const u=(n=(e=(t=c.candidates)==null?void 0:t[0])==null?void 0:e.content)==null?void 0:n.parts.find(f=>f.inlineData);if(u!=null&&u.inlineData){const f=u.inlineData.data;setTimeout(()=>{o.close();const p=`data:image/png;base64,${f}`,g=en({type:"ai-model",result:p,prompt:m.prompt,clothingImages:m.clothingImages.map(h=>`data:${h.mimeType};base64,${h.base64}`)});T({resultImage:p,currentHistoryId:g.id})},1500)}else throw o.close(),new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.")}catch(i){o.close(),T({view:"ai-model",error:O(i)})}},la=()=>{if(m.imageHistory.length>0){const o=[...m.redoHistory];m.resultImage&&o.push(m.resultImage);const t=[...m.imageHistory],e=t.pop();T({resultImage:e,imageHistory:t,redoHistory:o,error:null})}},aa=()=>{if(m.redoHistory.length>0){const o=[...m.imageHistory];m.resultImage&&o.push(m.resultImage);const t=[...m.redoHistory],e=t.pop();T({resultImage:e,imageHistory:o,redoHistory:t,error:null})}},ua=async()=>{var o,t,e;if(!m.resultImage||!m.editPrompt){T({error:"Molimo vas unesite opis izmene."});return}T({error:null,isLoading:!0});try{const n=[...m.imageHistory];m.resultImage&&n.push(m.resultImage);const i=[],a={inlineData:{data:m.resultImage.split(",")[1],mimeType:"image/png"}},c={text:`${m.editPrompt} IMPORTANT: When making edits, do not add, remove, or modify any existing clothing items, logos, text, patterns, or details on the clothing. Preserve all garments exactly as they are. Only modify what is specifically requested in the prompt.`},f=(e=(t=(o=(await J.models.generateContent({model:"gemini-2.5-flash-image-preview",contents:{parts:[a,c]},config:{responseModalities:[b.IMAGE,b.TEXT],imageConfig:{aspectRatio:"1:1",numberOfImages:1}}})).candidates)==null?void 0:o[0])==null?void 0:t.content)==null?void 0:e.parts.find(p=>p.inlineData);if(f!=null&&f.inlineData){const g=`data:image/png;base64,${f.inlineData.data}`;m.currentHistoryId&&na(m.currentHistoryId,{result:g}),T({resultImage:g,editPrompt:"",imageHistory:n,redoHistory:i})}else throw new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.")}catch(n){T({error:O(n)})}finally{T({isLoading:!1})}},da=async()=>{console.log("🧪 Testing The New Black API manually...");try{const o=new FormData;o.append("email","nocodebalkan@gmail.com"),o.append("password","fashionmaster"),o.append("image","https://example.com/test.png"),o.append("prompt","test video"),console.log("🚀 Testing ai-video endpoint...");const t=await fetch("https://thenewblack.ai/api/1.1/wf/ai-video",{method:"POST",body:o});console.log("📊 Response status:",t.status,t.statusText),console.log("📊 Response headers:",[...t.headers.entries()]);const e=await t.text();console.log("📋 Response body:",e)}catch(o){console.error("❌ Test API error:",o)}};window.testVideoAPI=da;const ca=async o=>{console.log("🔍 Manually checking video status for ID:",o);try{const t=await fetch("/api/results-video",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o})});if(t.ok){const e=await t.text();return console.log("📋 Manual check result:",e),e.startsWith("http")&&e.includes(".mp4")?(console.log("✅ Video is ready!",e),e):(console.log("⏳ Video still processing..."),null)}else return console.error("❌ Manual check failed:",t.status),null}catch(t){return console.error("❌ Manual check error:",t),null}};window.checkVideoStatus=ca;const fa=async()=>{var n,i,l,a,d,c,u,f,p,g,h,y,v,C,S,_,A;if(!m.resultImage||!m.videoPrompt){T({error:"Molimo vas unesite opis za animaciju."});return}T({error:null,isLoading:!0,resultVideoUrl:null,loadingMessage:"Masterbot postavlja scenu..."});const o=["Kamere se pale...","Kreiranje AI video klipa sa Google Veo 3...","Renderovanje video sekvenci...","Finalni kadrovi se obrađuju..."];let t=0;const e=setInterval(()=>{t=(t+1)%o.length,T({loadingMessage:o[t]})},1e4);try{console.log("🎬 Starting video generation with Google Veo..."),console.log("📝 Video prompt:",m.videoPrompt),console.log("🔑 API Key available:","YES");const E=m.resultImage.split(",")[1];console.log("🖼️ Image data length:",E.length),console.log("🚀 Calling Google Veo 3 API...");const w="Keep clothing exactly as shown in image. No changes to garments.",N=`Create a ${m.videoLength}-second video in ${m.videoAspectRatio} aspect ratio at ${m.videoResolution} resolution.`,V="High quality, smooth motion, professional cinematography.",L=m.videoWithoutAudio?"Generate video without audio track - silent video only.":"",F=`${m.videoPrompt}. ${N} ${V} ${L} ${w}`;console.log("📝 Enhanced video prompt with format specs:",F);let M;const U=["veo-3.0-fast-generate-001","veo-3.0-fast-generate-preview","veo-2.0-generate-001"];for(const x of U)try{console.log(`🔄 Trying model: ${x}`),console.log(`📐 Requested aspect ratio: ${m.videoAspectRatio}`),console.log(`⏱️ Requested video length: ${m.videoLength} seconds`),M=await J.models.generateVideos({model:x,prompt:F,image:{imageBytes:E,mimeType:"image/png"},config:{numberOfVideos:1,...m.videoWithoutAudio&&{audioTrack:!1}}}),console.log(`✅ Successfully using model: ${x}`),console.log("📋 Operation created with ID:",M.name);break}catch(z){if(console.log(`❌ Model ${x} not available:`,z.message),x===U[U.length-1])throw z}console.log("⏳ Initial operation response:",M);let H=0;const K=30;for(;!M.done&&H<K;){H++,console.log(`⏰ Waiting for video generation... (attempt ${H}/${K})`),await new Promise(x=>setTimeout(x,1e4));try{M=await J.operations.getVideosOperation({operation:M}),console.log("📊 Operation status:",M.done?"COMPLETED":"IN PROGRESS")}catch(x){throw console.error("❌ Error polling operation:",x),new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.")}}if(H>=K)throw new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.");if(M.error)throw console.error("❌ Operation failed with error:",M.error),new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.");console.log("✅ Video generation completed!"),console.log("📋 Full operation response:",JSON.stringify(M,null,2));let D=((a=(l=(i=(n=M.response)==null?void 0:n.generatedVideos)==null?void 0:i[0])==null?void 0:l.video)==null?void 0:a.uri)||((u=(c=(d=M.response)==null?void 0:d.videos)==null?void 0:c[0])==null?void 0:u.uri)||((h=(g=(p=(f=M.response)==null?void 0:f.results)==null?void 0:p[0])==null?void 0:g.video)==null?void 0:h.uri)||((C=(v=(y=M.response)==null?void 0:y.output)==null?void 0:v.video)==null?void 0:C.uri)||((A=(_=(S=M.result)==null?void 0:S.videos)==null?void 0:_[0])==null?void 0:A.uri);if(console.log("🔗 Download link:",D),D){console.log("📥 Downloading video...");try{let x=await fetch(`${D}&key=AIzaSyC-ntmyrIlXwje5m8lh_ay3fvyBWVZzrYk`);if(console.log("📊 Download response status:",x.status,x.statusText),x.ok||(console.log("🔄 Retrying download without API key parameter..."),x=await fetch(D),console.log("📊 Retry response status:",x.status,x.statusText)),!x.ok)throw new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.");const z=await x.blob();if(console.log("📦 Video blob size:",z.size,"bytes"),console.log("📦 Video blob type:",z.type),z.size===0)throw new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.");const Pe=URL.createObjectURL(z);console.log("🎥 Video URL created:",Pe),T({resultVideoUrl:Pe})}catch(x){throw console.error("❌ Download failed:",x),new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.")}}else throw console.error("❌ No download link in response"),new Error("Masterbot nije uspeo realizaciju. Molimo pokušajte ponovo ili unesite precizniji opis.")}catch(E){console.error("💥 Video generation error:",E),console.error("💥 Error stack:",E.stack),T({error:O(E)})}finally{clearInterval(e),T({isLoading:!1,loadingMessage:"Kreiranje magije..."})}},pa=fa,we=o=>m.resultImage?`
    <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle">
            Preuzmi
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" width="20" height="20"><path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" /></svg>
        </button>
        <div class="dropdown-menu">
            <a href="${m.resultImage}" download="${o}-original.png" class="dropdown-item">Original</a>
            <button class="dropdown-item" data-aspect="9:16" data-filenamebase="${o}">Story (9:16)</button>
            <button class="dropdown-item" data-aspect="4:5" data-filenamebase="${o}">Post (4:5)</button>
        </div>
    </div>
    `:"",Me=()=>{document.querySelectorAll(".dropdown").forEach(o=>{const t=o.querySelector(".dropdown-toggle");t==null||t.addEventListener("click",e=>{e.stopPropagation(),document.querySelectorAll(".dropdown").forEach(n=>{n!==o&&n.classList.remove("active")}),o.classList.toggle("active")})}),document.querySelectorAll(".dropdown-item[data-aspect]").forEach(o=>{o.addEventListener("click",t=>{const e=t.currentTarget,n=e.dataset.aspect,i=e.dataset.filenamebase;if(m.resultImage&&n&&i){const[l,a]=n.split(":").map(Number),d=l/a;jl(m.resultImage,d,`${i}-${n.replace(":","x")}.png`);const c=e.closest(".dropdown");c==null||c.classList.remove("active")}})}),document.querySelectorAll(".dropdown-item[data-caption-type]").forEach(o=>{o.addEventListener("click",t=>{const e=t.currentTarget,n=e.dataset.captionType;if(n){Ae(n);const i=e.closest(".dropdown");i==null||i.classList.remove("active")}})}),document.addEventListener("click",o=>{var n;const t=o.target;((n=t==null?void 0:t.closest)==null?void 0:n.call(t,".dropdown"))||document.querySelectorAll(".dropdown").forEach(i=>i.classList.remove("active"))})},ga=()=>{var o,t,e;$.innerHTML=`
    <div class="home-container">
      <h1>Masterbot Fashion</h1>
      <p class="subtitle">Tvoja AI modna inspiracija</p>
      <div class="card-container">
        <div class="card" id="go-to-try-on">
             <img src="/assets/ikonicasredjena.png" alt="Virtuelno Probaj ikonica" class="card-main-icon">
            <h3>Virtuelno Probaj</h3>
            <p>Postavi svoju sliku i sliku odeće da vidiš kako ti stoji.</p>
        </div>
        <div class="card" id="go-to-ai-model">
            <svg xmlns="http://www.w3.org/2000/svg" class="card-main-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C9.24 2 7 4.24 7 7s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM12 10c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zM20.59 12.06l-1.42 1.42C18.98 13.68 18.74 14 18.45 14H5.55c-.29 0-.53-.32-.72-.51l-1.42-1.42C3.02 11.67 3 11.14 3.3 10.85l1.42-1.42C4.91 9.24 5.2 9 5.5 9h13c.3 0 .59.24.78.43l1.42 1.42c.3.29.31.82.09 1.21zM5.5 16h13c.28 0 .5.22.5.5v3c0 .28-.22.5-.5.5h-13c-.28 0-.5-.22-.5-.5v-3c0-.28.22-.5.5-.5z"/>
            </svg>
            <h3>Generiši AI Modela</h3>
            <p>Kreiraj jedinstvenog AI modela sa odećom po izboru.</p>
        </div>
        
        <div class="card" id="go-to-history">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M13.5 8H12V13L16.28 15.54L17 14.33L13.5 12.25V8ZM13 3C8.03 3 4 7.03 4 12H1L4.89 15.89L4.96 16.03L9 12H6C6 8.13 9.13 5 13 5S20 8.13 20 12S16.87 19 13 19C11.07 19 9.32 18.21 8.06 16.94L6.64 18.36C8.27 20 10.5 21 13 21C18.97 21 23 16.97 23 11C23 5.03 18.97 1 13 3Z"/></svg>
            <h3>Moje Kreacije</h3>
            <p>Pogledaj svoje prethodne kreacije i rezultate.</p>
        </div>
      </div>
    </div>`,(o=document.getElementById("go-to-try-on"))==null||o.addEventListener("click",()=>T({view:"try-on",error:null,userImage:null,clothingImage:null,step1ModelImage:null,tryOnStep:1,prompt:"",resultImage:null,resultVideoUrl:null,generatedCaption:null,captionType:null})),(t=document.getElementById("go-to-ai-model"))==null||t.addEventListener("click",()=>{T({view:"ai-model"}),jt()}),(e=document.getElementById("go-to-history"))==null||e.addEventListener("click",()=>T({view:"history"}))},ma=()=>{var e,n,i,l,a,d,c,u,f,p;const o=m.userImage?`data:${m.userImage.mimeType};base64,${m.userImage.base64}`:"",t=m.clothingImage?`data:${m.clothingImage.mimeType};base64,${m.clothingImage.base64}`:"";m.step1ModelImage,$.innerHTML=`
    <div class="split-container">
      <div class="control-panel">
        <button class="btn-back" id="back-btn">&larr; Nazad na početnu</button>
        <div class="panel-header">
            <h2>Virtuelno Probaj</h2>
            <p>Dvokorakni proces za najbolji rezultat.</p>
        </div>
        
        <!-- Step Indicator -->
        <div class="step-indicator" style="display: flex; margin-bottom: 20px; background: #f8f9fa; border-radius: 8px; padding: 8px;">
            <div class="step ${m.tryOnStep===1?"active":m.tryOnStep===2?"completed":""}" style="flex: 1; text-align: center; padding: 8px; border-radius: 6px; font-size: 12px; font-weight: 600;">
                <div style="color: ${m.tryOnStep===1?"#007bff":m.tryOnStep===2?"#28a745":"#6c757d"};">1. Kreiraj Model</div>
            </div>
            <div class="step ${m.tryOnStep===2?"active":""}" style="flex: 1; text-align: center; padding: 8px; border-radius: 6px; font-size: 12px; font-weight: 600;">
                <div style="color: ${m.tryOnStep===2?"#007bff":"#6c757d"};">2. Obuci Garderobu</div>
            </div>
        </div>
        
        <div class="info-section" style="background: #f8f9fa; border-radius: 12px; padding: 16px; margin-bottom: 20px; display: flex; align-items: center; gap: 15px; border: 1px solid #e9ecef;">
            <img src="/assets/fashionsiluetea.png" alt="Fashion silhouette" style="width: 60px; height: 120px; object-fit: contain; flex-shrink: 0;">
            <div style="flex: 1;">
                <h4 style="margin: 0 0 6px 0; color: #2c3e50; font-size: 14px; font-weight: 600;">💡 Savet za najbolji rezultat</h4>
                <p style="margin: 0; color: #5a6c7d; font-size: 13px; line-height: 1.4;">${m.tryOnStep===1?"Prvo kreiramo model u kupaćem kostimu za bolje razumevanje anatomije.":"Sada stavljamo garderobu na modela iz prvog koraka."}</p>
            </div>
        </div>
        
        ${m.tryOnStep===1?`
        <!-- Step 1: User Image -->
        <div class="input-group">
            <label for="user-image" class="file-input-label ${o?"has-image":""}" id="user-image-dropzone">
                ${o?`<img src="${o}" class="image-preview" alt="Pregled korisnika">`:'<div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM20.944 20.004a.5.5 0 0 0-.447-.5h-17a.5.5 0 0 0-.447.5 10 10 0 0 0 17.894 0Z"/></svg><span>Dodaj svoju fotografiju<br><small style="opacity: 0.7;">ili prevuci sliku ovde</small></span></div>'}
                <input type="file" id="user-image" accept="image/*">
            </label>
        </div>
        
        ${m.error?`<div class="error-message">${m.error}</div>`:""}
        <button class="btn btn-primary" id="generate-step1" ${m.userImage?"":"disabled"}>Kreiraj Model u Kupaćem</button>
        `:`
        <!-- Step 2: Clothing Image -->
        <div class="input-group">
            <label for="clothing-image" class="file-input-label ${t?"has-image":""}" id="clothing-image-dropzone">
                 ${t?`<img src="${t}" class="image-preview" alt="Pregled odeće">`:'<div><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="40" height="40"><path d="M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.45a1 1 0 0 0 .94.86h13.4c.56 0 1.03-.44 1.08-.99l.58-3.45a2 2 0 0 0-1.34-2.23z"></path><path d="M4 10h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10z"></path></svg><span>Dodaj fotografiju odeće<br><small style="opacity: 0.7;">ili prevuci sliku ovde</small></span></div>'}
                <input type="file" id="clothing-image" accept="image/*">
            </label>
        </div>
        
        ${m.error?`<div class="error-message">${m.error}</div>`:""}
        <button class="btn btn-primary" id="generate-try-on" ${m.clothingImage?"":"disabled"}>Obuci Garderobu</button>
        <button class="btn btn-secondary" id="back-to-step1" style="margin-top: 10px;">← Nazad na korak 1</button>
        `}
      </div>
      <div class="result-panel">
        ${m.isLoading?'<div class="loader-container"><div class="spinner"></div><p>Masterbot radi na detaljima...</p></div>':m.tryOnStep===1&&m.step1ModelImage?`
                <div class="result-container">
                    <img src="${m.step1ModelImage}" alt="Model u kupaćem" class="result-image"/>
                    <div class="button-group">
                        <button class="btn btn-primary" id="continue-to-step2">Nastavi na korak 2 →</button>
                    </div>
                </div>`:m.tryOnStep===2&&m.resultImage?`
                <div class="result-container">
                    <img src="${m.resultImage}" alt="Generisana slika" class="result-image"/>
                    <div class="button-group">
                    ${we("masterbot-tryon")}
                    <div class="dropdown caption-dropdown">
                        <button class="dropdown-toggle btn btn-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16" style="margin-right: 6px;">
                              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            Generiši AI Opis
                        </button>
                        <div class="dropdown-menu">
                            <div class="dropdown-item" data-caption-type="facebook">📘 Facebook Post</div>
                            <div class="dropdown-item" data-caption-type="instagram">📷 Instagram Post</div>
                            <div class="dropdown-item" data-caption-type="shop">🛍️ Shop Opis</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" id="try-again">Obuci novu kombinaciju</button>
                </div>
                    ${m.generatedCaption?`
                        <div class="caption-container" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                            <h4 style="margin: 0 0 10px 0; color: #2c3e50; font-size: 14px; font-weight: 600;">
                                ${m.captionType==="facebook"?"📘 Facebook Post":m.captionType==="instagram"?"📷 Instagram Post":"🛍️ Shop Opis"}
                            </h4>
                            <p style="margin: 0; color: #495057; font-size: 13px; line-height: 1.5; white-space: pre-wrap;">${m.generatedCaption}</p>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button class="btn btn-sm btn-outline" id="copy-caption" style="font-size: 12px;">Kopiraj</button>
                                <button class="btn btn-sm btn-primary" id="regenerate-caption" style="font-size: 12px;">Generiši Ponovo</button>
                            </div>
                        </div>
                    `:""}
                </div>`:'<p>Vaš rezultat će se pojaviti ovde.</p><p class="generation-time">Vreme potrebno za generisanje slike je 15-45 sekundi.</p>'}
      </div>
    </div>
    
    <div class="disclaimer">
      <div class="disclaimer-content">
        <div class="disclaimer-header">
          <span class="disclaimer-icon">💎</span>
          <strong>Masterbot AI Fashion</strong>
        </div>
        <p class="disclaimer-text">
          vodi računa o detaljima i na to smo izuzetno ponosni.<br>
          Ipak, veštačka inteligencija može ponekad da pogreši – <em>slobodno pokušajte ponovo sa jasnijom fotografijom</em> da biste dobili bolji rezultat.
        </p>
      </div>
    </div>`,(e=document.getElementById("back-btn"))==null||e.addEventListener("click",()=>T({view:"home"})),(n=document.getElementById("user-image"))==null||n.addEventListener("change",g=>te(g,"userImage")),(i=document.getElementById("clothing-image"))==null||i.addEventListener("change",g=>te(g,"clothingImage")),(l=document.getElementById("generate-step1"))==null||l.addEventListener("click",ia),(a=document.getElementById("generate-try-on"))==null||a.addEventListener("click",ra),(d=document.getElementById("continue-to-step2"))==null||d.addEventListener("click",()=>T({tryOnStep:2})),(c=document.getElementById("back-to-step1"))==null||c.addEventListener("click",()=>T({tryOnStep:1})),(u=document.getElementById("try-again"))==null||u.addEventListener("click",()=>T({resultImage:null,error:null,step1ModelImage:null,tryOnStep:1})),(f=document.getElementById("copy-caption"))==null||f.addEventListener("click",()=>{m.generatedCaption&&navigator.clipboard.writeText(m.generatedCaption).then(()=>{const g=document.getElementById("copy-caption");g&&(g.textContent="Kopirano!",setTimeout(()=>g.textContent="Kopiraj",2e3))})}),(p=document.getElementById("regenerate-caption"))==null||p.addEventListener("click",()=>{m.captionType&&Ae(m.captionType)}),Me(),X("user-image-dropzone","user-image",g=>{if(g[0]){const h=document.getElementById("user-image"),y=new DataTransfer;y.items.add(g[0]),h.files=y.files,te({target:h},"userImage")}}),X("clothing-image-dropzone","clothing-image",g=>{if(g[0]){const h=document.getElementById("clothing-image"),y=new DataTransfer;y.items.add(g[0]),h.files=y.files,te({target:h},"clothingImage")}})},ha=()=>{var e,n,i,l,a,d,c,u,f;let o="";m.isLoading?o=`<div class="loader-container"><div class="spinner"></div><p>${m.loadingMessage}</p></div>`:m.resultImage?o=`
            <div class="result-container">
                <img src="${m.resultImage}" alt="Generisana slika" class="result-image"/>
                <div class="button-group">
                    <button class="btn btn-secondary" id="edit-image">Edituj Sliku</button>
                    <button class="btn btn-secondary" id="create-video">Generiši Video</button>
                    ${we("masterbot-fashion")}
                    <div class="dropdown caption-dropdown">
                        <button class="dropdown-toggle btn btn-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16" style="margin-right: 6px;">
                              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                            </svg>
                            Generiši AI Opis
                        </button>
                        <div class="dropdown-menu">
                            <div class="dropdown-item" data-caption-type="facebook">📘 Facebook Post</div>
                            <div class="dropdown-item" data-caption-type="instagram">📷 Instagram Post</div>
                            <div class="dropdown-item" data-caption-type="shop">🛍️ Shop Opis</div>
                        </div>
                    </div>
                </div>
                 <button class="btn btn-tertiary" id="try-again">Obuci novu kombinaciju</button>
                 ${m.generatedCaption?`
                     <div class="caption-container" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                         <h4 style="margin: 0 0 10px 0; color: #2c3e50; font-size: 14px; font-weight: 600;">
                             ${m.captionType==="facebook"?"📘 Facebook Post":m.captionType==="instagram"?"📷 Instagram Post":"🛍️ Shop Opis"}
                         </h4>
                         <p style="margin: 0; color: #495057; font-size: 13px; line-height: 1.5; white-space: pre-wrap;">${m.generatedCaption}</p>
                         <div style="display: flex; gap: 10px; margin-top: 10px;">
                             <button class="btn btn-sm btn-outline" id="copy-caption" style="font-size: 12px;">Kopiraj</button>
                             <button class="btn btn-sm btn-primary" id="regenerate-caption" style="font-size: 12px;">Generiši Ponovo</button>
                         </div>
                     </div>
                 `:""}
            </div>`:o='<p>Vaš generisani model će se pojaviti ovde.</p><p class="generation-time">Vreme potrebno za generisanje slike je 15-45 sekundi.</p>',$.innerHTML=`
    <div class="split-container">
      <div class="control-panel">
        <button class="btn-back" id="back-btn">&larr; Nazad na početnu</button>
        <div class="panel-header">
            <h2>Generiši AI modela</h2>
            <p>Dodajte odeću, aksesoare i druge elemente i opišite modela koga želite da vidite.</p>
        </div>
        
        <div class="input-group" id="ai-clothing-input-group">
            <label for="ai-model-clothing-image">Odeća (do ${se} slika)</label>
            <div class="image-preview-grid" id="ai-clothing-dropzone">
                ${m.clothingImages.map((p,g)=>`
                    <div class="preview-item">
                        <img src="data:${p.mimeType};base64,${p.base64}" alt="Pregled odeće ${g+1}">
                        <button class="remove-btn" data-index="${g}" aria-label="Ukloni sliku ${g+1}">&times;</button>
                    </div>
                `).join("")}
            </div>
            ${m.clothingImages.length<se?`
                <label for="ai-model-clothing-image" class="btn btn-secondary upload-btn" id="ai-clothing-upload-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2h6Z"/></svg>
                    <span>${m.clothingImages.length>0?"Dodaj još":"Dodaj fotografije"}<br><small style="opacity: 0.7;">ili prevuci slike ovde</small></span>
                </label>
                <input type="file" id="ai-model-clothing-image" accept="image/*" multiple style="display: none;">
            `:""}
        </div>

        <div class="input-group">
            <label for="prompt">Opišite modela</label>
            <textarea id="prompt" placeholder="Npr: Mlad muškarac, 35 godina, stoji na ulicama Pariza noću, nosi ovu košulju.">${m.prompt}</textarea>
        </div>

        ${m.error?`<div class="error-message">${m.error}</div>`:""}
        <button class="btn btn-primary" id="generate-ai-model" ${m.clothingImages.length===0||!m.prompt?"disabled":""}>Generiši Sliku</button>
      </div>
      <div class="result-panel">
        ${o}
      </div>
    </div>
    
    <div class="disclaimer">
      <div class="disclaimer-content">
        <div class="disclaimer-header">
          <span class="disclaimer-icon">💎</span>
          <strong>Masterbot AI Fashion</strong>
        </div>
        <p class="disclaimer-text">
          vodi računa o detaljima i na to smo izuzetno ponosni.<br>
          Ipak, veštačka inteligencija može ponekad da pogreši – <em>slobodno pokušajte ponovo sa jasnijim opisom</em> da biste dobili bolji rezultat.
        </p>
      </div>
    </div>`,(e=document.getElementById("back-btn"))==null||e.addEventListener("click",()=>T({view:"home"})),(n=document.getElementById("ai-model-clothing-image"))==null||n.addEventListener("change",Lt),document.querySelectorAll(".remove-btn").forEach(p=>{p.addEventListener("click",g=>{const h=parseInt(g.currentTarget.dataset.index??"0",10);ea(h)})}),(i=document.getElementById("prompt"))==null||i.addEventListener("input",p=>{m.prompt=p.target.value;const g=document.getElementById("generate-ai-model");g&&(g.disabled=m.clothingImages.length===0||!m.prompt)}),(l=document.getElementById("generate-ai-model"))==null||l.addEventListener("click",sa),(a=document.getElementById("try-again"))==null||a.addEventListener("click",jt),(d=document.getElementById("edit-image"))==null||d.addEventListener("click",()=>T({view:"editor",originalEditorImage:m.resultImage,editPrompt:"",error:null,imageHistory:[],redoHistory:[]})),(c=document.getElementById("create-video"))==null||c.addEventListener("click",()=>T({view:"video-generator",error:null,resultVideoUrl:null,videoPrompt:""})),(u=document.getElementById("copy-caption"))==null||u.addEventListener("click",()=>{m.generatedCaption&&navigator.clipboard.writeText(m.generatedCaption).then(()=>{const p=document.getElementById("copy-caption");p&&(p.textContent="Kopirano!",setTimeout(()=>p.textContent="Kopiraj",2e3))})}),(f=document.getElementById("regenerate-caption"))==null||f.addEventListener("click",()=>{m.captionType&&Ae(m.captionType)}),Me();const t=p=>{const g=document.getElementById("ai-model-clothing-image"),h=new DataTransfer;p.forEach(y=>h.items.add(y)),g.files=h.files,Lt({target:g})};X("ai-clothing-input-group","ai-model-clothing-image",t),X("ai-clothing-dropzone","ai-model-clothing-image",t),X("ai-clothing-upload-btn","ai-model-clothing-image",t)},ya=()=>{var o,t,e,n,i;$.innerHTML=`
    <div class="split-container">
      <div class="control-panel">
        <button class="btn-back" id="back-to-result-btn">&larr; Nazad na rezultat</button>
        <div class="panel-header">
            <h2>Editor Slike</h2>
            <p>Opišite kako želite da izmenite sliku.</p>
        </div>
        
        <div class="input-group">
            <label>Original</label>
            <img src="${m.originalEditorImage}" alt="Originalna slika" class="image-preview-small"/>
        </div>

        <div class="input-group">
            <label for="edit-prompt">Opišite izmenu</label>
            <textarea id="edit-prompt" placeholder="Npr: Promeni pozadinu u plažu, dodaj šešir... (Garderoba se neće menjati)">${m.editPrompt}</textarea>
        </div>
        
        ${m.error?`<div class="error-message">${m.error}</div>`:""}
        <button class="btn btn-primary" id="generate-edit-btn" ${m.editPrompt?"":"disabled"}>Primeni izmenu</button>
      </div>
      <div class="result-panel">
        ${m.isLoading?'<div class="loader-container"><div class="spinner"></div><p>Masterbot sredjuje sliku...</p></div>':m.resultImage?`
                <div class="result-container">
                    <img src="${m.resultImage}" alt="Izmenjena slika" class="result-image"/>
                    <div class="undo-redo-group">
                        ${m.imageHistory.length>0?`
                            <button class="btn btn-secondary" id="undo-edit-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M7.82843 10.9999H20V12.9999H7.82843L13.1924 18.3638L11.7782 19.778L4 11.9999L11.7782 4.22168L13.1924 5.63589L7.82843 10.9999Z"/>
                                </svg>
                                Poništi izmenu
                            </button>
                        `:""}
                        ${m.redoHistory.length>0?`
                            <button class="btn btn-secondary" id="redo-edit-btn">
                                Vrati izmenu
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                    <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"/>
                                </svg>
                            </button>
                        `:""}
                    </div>
                    <div class="download-section">
                        ${we("masterbot-fashion-edit")}
                    </div>
                </div>`:"<p>Vaša izmenjena slika će se pojaviti ovde.</p>"}
      </div>
    </div>`,(o=document.getElementById("back-to-result-btn"))==null||o.addEventListener("click",()=>T({view:"ai-model",error:null})),(t=document.getElementById("edit-prompt"))==null||t.addEventListener("input",l=>{m.editPrompt=l.target.value;const a=document.getElementById("generate-edit-btn");a&&(a.disabled=!m.editPrompt)}),(e=document.getElementById("generate-edit-btn"))==null||e.addEventListener("click",ua),(n=document.getElementById("undo-edit-btn"))==null||n.addEventListener("click",la),(i=document.getElementById("redo-edit-btn"))==null||i.addEventListener("click",aa),Me()},va=()=>{const o=m.history.filter(c=>c.type==="try-on"),t=m.history.filter(c=>c.type==="ai-model"),e='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.45a1 1 0 0 0 .94.86h13.4c.56 0 1.03-.44 1.08-.99l.58-3.45a2 2 0 0 0-1.34-2.23z"></path><path d="M4 10h16v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V10z"></path></svg>',n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8.5l-3 3-3-3 3-3 3 3z"/><path d="M12 10.5V14"/><path d="M12 14c-4.66 0-8 1.5-8 4v2h16v-2c0-2.5-3.34-4-8-4z"/><path d="M12 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8z"/></svg>',i=c=>new Date(c).toLocaleDateString("sr-RS",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),l=c=>{if(c.length===0){const u=m.activeHistoryTab==="try-on";return`
                <div class="no-history">
                    <div class="empty-icon">${u?e:n}</div>
                    <h3>Nema kreacija</h3>
                    <p>Još nema kreacija u ${u?"Virtuelno Probaj":"AI Modeli"} kategoriji.</p>
                    <button class="btn btn-primary empty-cta" id="empty-state-cta">
                        ${u?"Probaj odeću":"Generiši AI model"}
                    </button>
                </div>
            `}return c.map(u=>`
            <div class="history-item">
                <div class="history-image-container">
                    <img src="${u.result}" alt="Kreacija" class="history-image"/>
                </div>
                <div class="history-info">
                    <div class="history-date">${i(u.timestamp)}</div>
                    ${u.prompt?`<div class="history-prompt">"${u.prompt}"</div>`:""}
                    <div class="history-actions">
                        <div class="history-actions-row">
                            ${u.type==="ai-model"?`
                            <button class="btn-sm btn-tertiary edit-history-item" data-id="${u.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
                                Uredi
                            </button>
                            `:""}
                            <button class="btn-sm btn-secondary delete-history-item" data-id="${u.id}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                Obriši
                            </button>
                        </div>
                        <div class="dropdown">
                            <button class="btn-sm btn-primary download-history-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                Preuzmi
                            </button>
                            <div class="dropdown-content">
                                <a href="#" class="download-history-post" data-id="${u.id}">Post (1:1)</a>
                                <a href="#" class="download-history-story" data-id="${u.id}">Story (9:16)</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `).join("")},a=(c,u,f,p)=>{const g=new Image;g.onload=()=>{const h=document.createElement("canvas"),y=h.getContext("2d");if(!y)return;const v=g.width,C=g.height,S=v/C,_=u/f;let A,E,w,N;S>_?(N=C,w=N*_,A=(v-w)/2,E=0):(w=v,N=w/_,A=0,E=(C-N)/2);const V=Math.min(w,2048);h.width=V,h.height=V/_,y.drawImage(g,A,E,w,N,0,0,h.width,h.height);const L=document.createElement("a");L.href=h.toDataURL("image/png"),L.download=p,document.body.appendChild(L),L.click(),document.body.removeChild(L)},g.crossOrigin="anonymous",g.src=c},d=()=>{var u;(u=document.getElementById("back-btn"))==null||u.addEventListener("click",()=>{T({view:"home"})}),document.querySelectorAll(".history-tab").forEach(f=>{f.addEventListener("click",()=>{const p=f.getAttribute("data-tab");T({activeHistoryTab:p})})}),document.querySelectorAll(".edit-history-item").forEach(f=>{f.addEventListener("click",()=>{const p=f.getAttribute("data-id"),g=m.history.find(h=>h.id===p);if(g&&g.type==="ai-model"&&g.clothingImages){const h=g.clothingImages.map(y=>{const v=y.split(","),C=v[0].match(/:(.*?);/),S=C?C[1]:"image/png";return{file:null,base64:v[1],mimeType:S}});T({view:"editor",resultImage:g.result,originalEditorImage:g.result,currentHistoryId:g.id,prompt:g.prompt||"",clothingImages:h,error:null,editPrompt:"",imageHistory:[],redoHistory:[]})}})}),document.querySelectorAll(".delete-history-item").forEach(f=>{f.addEventListener("click",()=>{const p=f.getAttribute("data-id");p&&confirm("Da li ste sigurni da želite da obrišete ovu kreaciju?")&&oa(p)})}),document.querySelectorAll(".download-history-item").forEach(f=>{f.addEventListener("click",()=>{const p=f.getAttribute("data-id"),g=m.history.find(h=>h.id===p);if(g){const h=document.createElement("a");h.href=g.result,h.download=`Masterbot_kreacija_${g.id.substring(0,8)}.png`,h.click()}})}),document.querySelectorAll(".download-history-btn").forEach(f=>{f.addEventListener("click",p=>{p.stopPropagation();const g=f.nextElementSibling,h=g.classList.contains("show");document.querySelectorAll(".dropdown-content.show").forEach(y=>{y.classList.remove("show")}),h||g.classList.add("show")})}),document.querySelectorAll(".download-history-post").forEach(f=>{f.addEventListener("click",p=>{var y;p.preventDefault(),p.stopPropagation();const g=f.getAttribute("data-id"),h=m.history.find(v=>v.id===g);h&&a(h.result,1,1,`Masterbot_post_${h.id.substring(0,8)}.png`),(y=f.closest(".dropdown-content"))==null||y.classList.remove("show")})}),document.querySelectorAll(".download-history-story").forEach(f=>{f.addEventListener("click",p=>{var y;p.preventDefault(),p.stopPropagation();const g=f.getAttribute("data-id"),h=m.history.find(v=>v.id===g);h&&a(h.result,9,16,`Masterbot_story_${h.id.substring(0,8)}.png`),(y=f.closest(".dropdown-content"))==null||y.classList.remove("show")})}),window.addEventListener("click",f=>{f.target.matches(".download-history-btn")||document.querySelectorAll(".dropdown-content.show").forEach(p=>{p.classList.remove("show")})});const c=document.getElementById("empty-state-cta");c&&c.addEventListener("click",()=>{const f=m.activeHistoryTab==="try-on"?"try-on":"ai-model";T({view:f})})};$.innerHTML=`
        <div class="container">
            <div class="history-header">
                <button class="btn btn-secondary" id="back-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                    Nazad
                </button>
                <div class="history-title">
                    <h2>
                        <span class="title-icon">🎨</span>
                        Moje Kreacije
                    </h2>
                    <p class="title-subtitle">Tvoja kolekcija Masterbot kreacija</p>
                </div>
            </div>
            
            <div class="history-tabs">
                <button class="history-tab ${m.activeHistoryTab==="try-on"?"active":""}" data-tab="try-on">
                    <span class="tab-icon">${e}</span>
                    <span class="tab-text">Virtuelno Probaj</span>
                    <span class="tab-count">${o.length}</span>
                </button>
                <button class="history-tab ${m.activeHistoryTab==="ai-model"?"active":""}" data-tab="ai-model">
                    <span class="tab-icon">${n}</span>
                    <span class="tab-text">AI Modeli</span>
                    <span class="tab-count">${t.length}</span>
                </button>
            </div>
            
            <div class="history-content">
                ${m.activeHistoryTab==="try-on"?l(o):l(t)}
            </div>
        </div>
    `,d()},Ta=()=>{var o,t,e,n,i,l,a,d;$.innerHTML=`
    <div class="split-container">
      <div class="control-panel">
        <button class="btn-back" id="back-to-result-btn">&larr; Nazad na rezultat</button>
        <div class="panel-header">
            <h2>Generiši Video Klip</h2>
            <p>Kreirajte video animaciju od vaše AI slike koristeći naprednu AI tehnologiju.</p>
        </div>
        
        <div class="input-group">
            <label>Slika za animaciju</label>
            <img src="${m.resultImage}" alt="Slika za animaciju" class="image-preview-small"/>
        </div>

        <div class="input-group">
            <label for="video-prompt">Opišite animaciju/pokret</label>
            <textarea id="video-prompt" placeholder="Npr: 'model šeta po pisti', 'okreće se u krug', 'maše rukom', 'pozira za kameru'...">${m.videoPrompt}</textarea>
        </div>
        
        <div class="video-controls-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin: 20px 0;">
            <div class="input-group">
                <label for="video-aspect-ratio">Format videa</label>
                <select id="video-aspect-ratio" class="form-select">
                    <option value="9:16" ${m.videoAspectRatio==="9:16"?"selected":""}>9:16 (Story)</option>
                    <option value="16:9" ${m.videoAspectRatio==="16:9"?"selected":""}>16:9 (Landscape)</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="video-length">Dužina videa</label>
                <select id="video-length" class="form-select">
                    <option value="4" ${m.videoLength===4?"selected":""}>4 sekunde</option>
                    <option value="6" ${m.videoLength===6?"selected":""}>6 sekundi</option>
                    <option value="8" ${m.videoLength===8?"selected":""}>8 sekundi</option>
                </select>
            </div>
            
            <div class="input-group">
                <label for="video-resolution">Kvalitet</label>
                <select id="video-resolution" class="form-select">
                    <option value="720p" ${m.videoResolution==="720p"?"selected":""}>720p (HD)</option>
                    <option value="1080p" ${m.videoResolution==="1080p"?"selected":""}>1080p (Full HD)</option>
                </select>
            </div>
        </div>
        
        <div class="input-group" style="margin: 20px 0;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="video-without-audio" ${m.videoWithoutAudio?"checked":""} style="margin: 0;">
                <span>🎵 Generiši video bez audio-a (silent video)</span>
            </label>
        </div>
        
        <div class="info-section" style="background: #f8f9fa; border-radius: 12px; padding: 16px; margin: 20px 0; border: 1px solid #e9ecef;">
            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <span style="font-size: 20px;">🎬</span>
                <h4 style="margin: 0; color: #2c3e50; font-size: 14px; font-weight: 600;">Google Veo 3 Fast - Image to Video</h4>
            </div>
            <p style="margin: 0; color: #5a6c7d; font-size: 13px; line-height: 1.4;">
                • Najnovija Google Veo tehnologija<br>
                • <strong>Image to Video</strong> - od slike do video klipa<br>
                • Format: <strong>${m.videoAspectRatio}</strong> | Dužina: <strong>${m.videoLength}s</strong> | Kvalitet: <strong>${m.videoResolution}</strong><br>
                • Audio: <strong>${m.videoWithoutAudio?"Bez audio-a (jeftinije!)":"Sa audio-om"}</strong><br>
                • ${m.videoWithoutAudio?"Direktni API parametar za uštedu":"Standardni API poziv"}
            </p>
        </div>
        
        ${m.error?`<div class="error-message">${m.error}</div>`:""}
        <button class="btn btn-primary" id="generate-video-btn" ${m.videoPrompt?"":"disabled"}>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20" style="margin-right: 8px;">
                <path d="M8 5v14l11-7z"/>
            </svg>
            Generiši Video Klip
        </button>
      </div>
      <div class="result-panel">
        ${m.isLoading?`<div class="loader-container"><div class="spinner"></div><p>${m.loadingMessage}</p></div>`:m.resultVideoUrl?`
                <div class="result-container">
                    <video src="${m.resultVideoUrl}" class="result-video" controls autoplay loop></video>
                    <div class="button-group">
                        <a href="${m.resultVideoUrl}" download="masterbot-fashion-video.mp4" class="btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16" style="margin-right: 6px;">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Preuzmi Video
                        </a>
                        <button class="btn btn-secondary" id="try-again-video-btn">Kreiraj novi video</button>
                    </div>
                </div>`:`
                <div class="empty-result">
                    <div style="text-align: center; color: #6c757d;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="64" height="64" style="margin-bottom: 16px; opacity: 0.5;">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                            <line x1="8" y1="21" x2="16" y2="21"></line>
                            <line x1="12" y1="17" x2="12" y2="21"></line>
                            <polygon points="10 8 16 12 10 16 10 8"></polygon>
                        </svg>
                        <p>Vaš generisani video će se pojaviti ovde.</p>
                        <p class="generation-time">Vreme potrebno za generisanje videa je 1-3 minuta.</p>
                    </div>
                </div>
            `}
      </div>
    </div>`,(o=document.getElementById("back-to-result-btn"))==null||o.addEventListener("click",()=>T({view:"ai-model",resultVideoUrl:null,videoPrompt:""})),(t=document.getElementById("video-prompt"))==null||t.addEventListener("input",c=>{m.videoPrompt=c.target.value;const u=document.getElementById("generate-video-btn");u&&(u.disabled=!m.videoPrompt)}),(e=document.getElementById("video-aspect-ratio"))==null||e.addEventListener("change",c=>{m.videoAspectRatio=c.target.value,console.log("📐 Video aspect ratio changed to:",m.videoAspectRatio)}),(n=document.getElementById("video-length"))==null||n.addEventListener("change",c=>{m.videoLength=parseInt(c.target.value),console.log("⏱️ Video length changed to:",m.videoLength,"seconds")}),(i=document.getElementById("video-resolution"))==null||i.addEventListener("change",c=>{m.videoResolution=c.target.value,console.log("🎥 Video resolution changed to:",m.videoResolution)}),(l=document.getElementById("video-without-audio"))==null||l.addEventListener("change",c=>{m.videoWithoutAudio=c.target.checked,console.log("🔇 Video without audio:",m.videoWithoutAudio)}),(a=document.getElementById("generate-video-btn"))==null||a.addEventListener("click",pa),(d=document.getElementById("try-again-video-btn"))==null||d.addEventListener("click",()=>T({resultVideoUrl:null,videoPrompt:"",error:null}))},xe=()=>{switch($.innerHTML="",m.view){case"home":ga();break;case"try-on":ma();break;case"ai-model":ha();break;case"editor":ya();break;case"video-generator":Ta();break;case"history":va();break}};T({history:ta()});xe();xe();
